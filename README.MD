# ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Login Application

## Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Git
```bash
git init
git remote add origin git@github.com:alkisax/loginAPP.git
git pull origin main
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Frontend (Vite)
```bash
npm create vite@latest frontend -- --template react
npm install
npm install axios
npm install react-bootstrap
npm install react-router-dom
npm install redux
npm install react-redux
npm install @reduxjs/toolkit
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Backend
```bash
npm init
npm install express
npm install mongoose
npm install dotenv
npm install bcrypt
npm install jsonwebtoken
npm install swagger-ui-express
npm install mongoose-to-swagger
npm install swagger-jsdoc
npm install winston
npm install winston-daily-rotate-file
npm install winston-mongodb
npm install google-auth-library
npm install axios
npm install cors
npm install morgan
npm install express-async-errors
npm install --save-dev nodemon
npm install --save-dev supertest
npm install --save-dev cross-env
npm install prop-types
npm install --save-dev jest @babel/preset-env @babel/preset-react eslint-plugin-jest
npm install --save-dev deep-freeze
```

**Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·**: Î•Ï€ÎµÎ¹Î´Î® Ï…Ï€Î®ÏÎ¾Îµ conflict Î¼Îµ Ï„Î¿ express-async-errors, Î­Î³Î¹Î½Îµ downgrade ÏƒÏ„Î¿ express:
```bash
npm install express@4
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Login Form
```jsx
return (
  <>
    <form onSubmit={handleLogin}>
      <div>
        username
        <input type="text"
        value={username}
        name="username"
        onChange={({target}) => setUsername(target.value)}
        autoComplete="username"
        />
      </div>
      <div>
        password
        <input type="text"
        value={password}
        name="password"
        onChange={({target}) => setPassword(target.value)}
        autoComplete="password"
        />
      </div>
    </form>
  </>
)
```

## Custom View ÏƒÏ„Î¿ Frontend

Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… component `userLogedInView.jsx`:
```jsx
const UserLogedInView = () => {
  return (
    <>
      <h1>Welcome user</h1>
    </>
  )
}
export default UserLogedInView
```

Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… `App.jsx`:
```jsx
import UserLogedInView from './components/userLogedInView'

const App = () => {
  const [user, setUser] = useState(null)

  return (
    <div>
      <h1>Login APP</h1>
      {user === null && <LoginForm />}
      {user !==  null && <UserLogedInView />}
    </div>
  )
}
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î’Î±ÏƒÎ¹ÎºÎ¿Ï CRUD ÏƒÏ„Î¿ Backend

Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· scripts ÏƒÏ„Î¿ `package.json`:
```json
"scripts": {
  "start": "node server.js",
  "dev": "node --watch server.js",
  "test": "echo \"Error: no test specified\" && exit 1"
}
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± .env
```
MONGODB_URI = mongodb+srv://alkis:{password}@cluster0.8ioq6.mongodb.net/loginAp?retryWrites=true&w=majority&appName=Cluster0
```

## ÎŸÏÎ³Î¬Î½Ï‰ÏƒÎ· Î¦Î±ÎºÎ­Î»Ï‰Î½
Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†Î±ÎºÎ­Î»Ï‰Î½: routes, models, controllers, services

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Models

### users.models.js
```javascript
const mongoose = require("mongoose")
const Schema = mongoose.Schema
const userSchema = new Schema({
  username:{
    type: String,
    required: [true, 'username is required'],
    unique:true
  },
  name:{
    type: String,
    required: false
  },
  roles:{
    type: [String],
    default: ['user']
  },
  email:{
    type: String,
    required: false,
    unique: true
  },
  password:{
    type: String,
    required: [true, 'password is required'],
  },
},
{
  collection: 'users',
  timestamps: true
})
module.exports = mongoose.model('User', userSchema)
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Controllers

### user.controller.js
```javascript
const User = require('../models/users.models')

exports.findAll = async (req,res) => {
 const results = await User.find()
 res.json(results)
}
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Routes

### user.routes.js
```javascript
const express = require('express')
const router = express.Router()
const userController = require('../controllers/user.controller.js')

router.get ('/', userController.findAll)

module.exports = router
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Server

### server.js
```javascript
require('dotenv').config()
require('express-async-errors')
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const { log } = require('winston')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ‰
app.use(express.json());

mongoose.set('strictQuery', false)
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    // console.log('connected to MongoDB', process.env.MONGODB_URI)
    console.log('connected to MongoDB')
  })
  .catch((error) => {
    console.log('error connecting to MongoDB:', error.message)
  })

app.use('/api/users', userRoutes)

// Start the server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

module.exports = app
```

## Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î§ÏÎ®ÏƒÏ„Î·

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
exports.create = async (req,res) => {
  const username = req.body.username
  const name = req.body.name
  const password = req.body.password
  const email = req.body.email
  const roles = req.body.roles

  // na prostethei elegxos me if

  try {
    const newUser = new User({
      username: username,
      name: name,
      password: password,
      email: email,
      roles: roles
    })
    await newUser.save()
    res.status(201).json(newUser)
  } catch(error) {
    res.status(400).json({error: error.message})
  }
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.routes.js
```javascript
router.get ('/', userController.findAll)
router.post('/', userController.create)
```

## Î”Î¿ÎºÎ¹Î¼Î® Î¼Îµ Postman

- GET ÏƒÏ„Î¿ `localhost:3000/api/users`: Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ `{ "status": true, "data": [] }`
- POST ÏƒÏ„Î¿ `localhost:3000/api/users` Î¼Îµ body:
  ```json
  {
      "username":"alkisax",
      "name":"alkis",
      "roles":["admin"],
      "email": "alkisax@gmail.com",
      "password":"123"
  }
  ```
  Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ:
  ```json
  {
      "username": "alkisax",
      "name": "alkis",
      "roles": [
          "admin"
      ],
      "email": "alkisax@gmail.com",
      "password": "123",
      "_id": "67fc141a3af9a6a44597fc51",
      "createdAt": "2025-04-13T19:44:26.990Z",
      "updatedAt": "2025-04-13T19:44:26.990Z",
      "__v": 0
  }
  ```

## ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Ï„Î¿Ï… Password ÏƒÎµ hashedPassword

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… users.models.js
```javascript
// password:{
//   type: String,
//   required: [true, 'password is required'],
// },
hashedPassword: {
  type: String,
  required: [true, 'password is required'],
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
const bcrypt = require('bcrypt')

// Î£Ï„Î¿ exports.create
const SaltOrRounds = 10
const hashedPassword = await bcrypt.hash(password, SaltOrRounds)

// ÎšÎ±Î¹ Ï„Î¿ newUser Î³Î¯Î½ÎµÏ„Î±Î¹:
const newUser = new User({
  username: username,
  name: name,
  hashedPassword: hashedPassword,
  email: email,
  roles: roles
})
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Login Endpoint

### services/auth.service.js
```javascript
const jwt = require('jsonwebtoken')
const bcrypt = require('bcrypt')

generateAccessToken = (user) => {
  const payload = {
    username: user.username,
    email: user.email,
    roles: user.roles,
    id: user._id
  }

  const secret = process.env.SECRET
  const options = {
    expiresIn: '1h'
  }
  const token = jwt.sign(payload, secret, options)
  return token
}

const verifyPassword = async (password, hashedPassword) => {
  return await bcrypt.compare(password, hashedPassword)
}

const verifyAccessToken = (token) => {
  const secret = process.env.SECRET
  try {
    const payload = jwt.verify(token, secret)
    return { 
      verified: true, data: payload
    }
  } catch (error) {
    return { 
      verified: false, data: error.message
    }
  }
} 

module.exports = {
  generateAccessToken,
  verifyPassword,
  verifyAccessToken
}
```

### auth.controller.js
```javascript
const bcrypt = require('bcrypt')
const User = require('../models/users.models')

exports.findAll = async (req,res) => {
 const results = await User.find()
 res.json({
  status: true,
  data: results
})
}

exports.create = async (req,res) => {
  let data = req.body

  const username = req.body.username
  const name = req.body.name
  const password = req.body.password
  const email = req.body.email
  const roles = req.body.roles

  const SaltOrRounds = 10
  const hashedPassword = await bcrypt.hash(password, SaltOrRounds)

  // na prostethei elegxos me if

  try {
    const newUser = new User({
      username: username,
      name: name,
      hashedPassword: hashedPassword,
      email: email,
      roles: roles
    })
    await newUser.save()
    res.status(201).json(newUser)
  } catch(error) {
    res.status(400).json({error: error.message})
  }
}
```

### auth.routes.js
```javascript
const express = require('express')
const router = express.Router()
const authController = require('../controllers/auth.controller')

router.post('/', authController.login)

module.exports = router
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· server.js
```javascript
const authRoutes = require('./routes/auth.routes.js')

app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
```

## Î”Î¿ÎºÎ¹Î¼Î® Login Î¼Îµ Postman

- POST ÏƒÏ„Î¿ `localhost:3000/api/login` Î¼Îµ body:
  ```json
  {
      "username": "alkisax",
      "password": "123"
  }
  ```
  Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ:
  ```json
  {
    "status": true,
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFsa2lzYXgiLCJlbWFpbCI6ImFsa2lzYXhAZ21haWwuY29tIiwicm9sZXMiOlsiYWRtaW4iXSwiaWQiOiI2N2ZjYTljODI1YWM4ZTBhMTM0N2JjZDQiLCJpYXQiOjE3NDQ2MTIzMTksImV4cCI6MTc0NDYxNTkxOX0.BCsm61ls3meU3ZOxgeQrZ3fNFTm7_5jru65qfrOBKyg",
        "user": {
            "username": "alkisax",
            "email": "alkisax@gmail.com",
            "roles": [
                "admin"
            ],
            "id": "67fca9c825ac8e0a1347bcd4"
        }
     }
  }
  ```

## Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Token Î³Î¹Î± Route Protection

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ auth.service.js
```javascript
const getTokenFrom = (req) => {
  const authorization = req.get('authorization')
  if (authorization && authorization.toLowerCase().startsWith('bearer ')) {
    return authorization.replace('Bearer ', '')
  }
  return null
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
exports.findAll = async (req,res) => {
  const results = await User.find()

  const token = authService.getTokenFrom(req)
  const verificationResult = authService.verifyAccessToken(token)
  if (!verificationResult.verified) {
    return res.status(401).json({
      status: false,
      error: verificationResult.data
    })
  }
  if (!verificationResult.data.roles.includes('admin')) {
    return res.status(403).json({
      status: false,
      error: 'Forbidden'
    })
  }

  res.json({
    status: true,
    data: results
  })
}
```

## Î”Î¿ÎºÎ¹Î¼Î® Î¼Îµ Postman ÎºÎ±Î¹ Token
GET ÏƒÏ„Î¿ `localhost:3000/api/users` Î¼Îµ Header:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½.

## Google Login

### Î¡ÏÎ¸Î¼Î¹ÏƒÎ· ÏƒÏ„Î¿ Google Cloud Platform
1. https://cloud.google.com/gcp -> console -> select project -> new project
2. API and services -> credentials -> create credentials -> oauth client ID
3. Configure consent screen -> create oauth client -> web app
4. Auth redirect uri -> http://localhost:3000/api/auth/google/callback
5. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± clients

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ .env
```
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...
REDIRECT_URI=http://localhost:3000/api/auth/google/callback
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… server.js
```javascript
app.use('/api/auth', authRoutes)
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… auth.routes.js
```javascript
router.get('/google/callback', authController.googleLogin)
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… auth.controller.js
```javascript
exports.googleLogin = async(req, res) => {
  const code = req.query.code
  if (!code) {
    res.status(400).json({status: false, data: "auth code is missing"})
  } else {
    let { user } = await authService.googleAuth(code)
    return res.redirect('https://www.wikipedia.org') //Ï€ÏÎ¿ÏƒÎ¿ÏÎ¹Î½Î± Î³Î¹Î± Î»Î¿Î³Î¿Ï…Ï‚ Ï„ÎµÏƒÏ„Î¹Î½Î³Îº
  }
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… auth.service.js
```javascript
const { OAuth2Client } = require('google-auth-library')
[...]
const googleAuth = async (code) => {
  console.log("Google login", code);
  const CLIENT_ID = process.env.GOOGLE_CLIENT_ID;
  const CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;
  const REDIRECT_URI = process.env.REDIRECT_URI;

  const oauth2Client = new OAuth2Client(CLIENT_ID, CLIENT_SECRET, REDIRECT_URI);

  try {
    // Exchange code for tokens
    const { tokens } = await oauth2Client.getToken(code)
    console.log("Step 1", tokens)
    oauth2Client.setCredentials(tokens)

    const ticket = await oauth2Client.verifyIdToken({
      idToken: tokens.id_token,
      audience: CLIENT_ID
    });

    console.log("Step 2")

    const userInfo = await ticket.getPayload();
    console.log("Google User", userInfo);
    return {user: userInfo, tokens}
  } catch (error) {
    console.log("Error in google authentication", error);
    return { error: "Failed to authenticate with google"}
  }
}

module.exports = {
  generateAccessToken,
  verifyPassword,
  verifyAccessToken,
  getTokenFrom,
  googleAuth
}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ‡Î¿Î»Î¯Î¿Ï… Î¼Îµ Ï„Î¿ Link ÏƒÏ„Î± routes
```javascript
// https://accounts.google.com/o/oauth2/auth?client_id={apo_to_google}&redirect_uri={apo_to_google}&response_type={apo_to_auth.service}&scope=email%20profile&access_type=offline
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Logger

### logger/logger.js
```javascript
const { createLogger, format, transports } = require('winston');
require('winston-mongodb');

const logger = createLogger({
  format: format.combine(
    format.timestamp(),
    format.simple()
  ),
  transports: [
    new transports.Console(), // show logs in terminal

    new transports.File({      // save to file
      filename: 'logs/all.log'
    }),

    new transports.MongoDB({   // save to MongoDB
      db: process.env.MONGODB_URI || 'mongodb://localhost:27017/logsdb',
      collection: 'logs',
      level: 'info',  // logs info and above (warn, error)
    })
  ]
});

module.exports = logger;
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… server.js
```javascript
const url = require('url');
const logger = require('./logger/logger.js');
[...]
app.use((req, res, next) => {
  const pathname = url.parse(req.originalUrl).pathname;
  logger.info(`${req.method} ${pathname}`);
  next();
});
```

### Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Logging ÏƒÏ„Î¿Ï…Ï‚ Controllers
```javascript
logger.error(`Login error: ${error.message}`);
logger.warn(`Failed login attempt with username: ${req.body.username}`);
logger.info(`User ${user.username} logged in successfully`);
if (user && user.email) {
  logger.info(`User ${user.email} logged in via Google`);
} else {
  logger.info('Google login succeeded, but user info is incomplete');
}
```

## Swagger Documentation

### Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
```bash
npm install swagger-jsdoc
```

### swagger.js
```javascript
// Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹ Mongoose models ÏƒÎµ Swagger schemas
const m2s = require('mongoose-to-swagger');
// Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¿Ï… Mongoose Î¼Î¿Î½Ï„Î­Î»Î¿Ï… Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·
const User = require('./models/users.models');
// Î— Î²Î±ÏƒÎ¹ÎºÎ® Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Swagger spec Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ configuration ÎºÎ±Î¹ Ï„Î± JSDoc ÏƒÏ‡ÏŒÎ»Î¹Î±
const swaggerJsdoc = require('swagger-jsdoc');
// ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Î³Î¹Î± Ï„Î· Swagger Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·
const options = {
  definition: {
    // ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Î·Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ OpenAPI (Swagger) Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯
    openapi: "3.1.0",
    // Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ API Î¼Î±Ï‚ (Ï„Î¯Ï„Î»Î¿Ï‚, Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î®, Î­ÎºÎ´Î¿ÏƒÎ·)
    info: {
      version: "1.0.0",
      title: "User and Auth API",
      description: "ÎœÎ¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ JWT ÎºÎ±Î¹ Google login",
    },
    // ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Ï‰Î½ components, Î´Î·Î»Î±Î´Î® Ï„Ï‰Î½ reusable ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Swagger ÏŒÏ€Ï‰Ï‚ schemas ÎºÎ±Î¹ security definitions
    components: {
      schemas: {
        // Î•Î´Ï Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Ï„Î¿ schema Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ Mongoose Î¼Î¿Î½Ï„Î­Î»Î¿
        User: m2s(User)
      },
      // Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼Î¿Ï Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¼Îµ Bearer token (JWT)
      securitySchemes: {
        bearerAuth: {
          type: "http",          // Î•Î¯Î´Î¿Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚
          scheme: "bearer",      // Î§ÏÎ®ÏƒÎ· Bearer token
          bearerFormat: "JWT"    // Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯Î¶Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ JWT
        }
      }
    },
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® Ï„Î·Ï‚ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ (bearerAuth) ÏƒÎµ ÏŒÎ»Î± Ï„Î± endpoints, ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Î±Î»Î»Î¹ÏÏ‚ ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿
    security: [
      {
        bearerAuth: []  // Î”ÎµÎ½ Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ scopes
      }
    ]
  },
  // ğŸ”½ Î¤Î¿ Ï€Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ ÏƒÎ·Î¼ÎµÎ¯Î¿: ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎ¿Î½Ï„Î±Î¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Swagger ÏƒÏ‡ÏŒÎ»Î¹Î± (JSDoc)
  // Î•Î´Ï Î²Î»Î­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï†Î±ÎºÎ­Î»Î¿Ï…Ï‚ routes ÎºÎ±Î¹ controllers Î³Î¹Î± Swagger annotations
  apis: ['./routes/*.js', './controllers/*.js'], // ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹Ï‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹Î± Î±Î½ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯
};
// Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Swagger specification Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¹Ï‚ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
const swaggerSpec = swaggerJsdoc(options);
// Î•Î¾Î±Î³Ï‰Î³Î® Ï„Î¿Ï… Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… ÏÏƒÏ„Îµ Î½Î± Ï„Î¿ Ï†Î¿ÏÏ„ÏÏƒÎ¿Ï…Î¼Îµ Î±Ï€ÏŒ Ï„Î¿ server.js
module.exports = swaggerSpec;
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… server.js
```javascript
const swaggerSpec = require('./swagger.js');
const swaggerUI = require('swagger-ui-express')
[...]
app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec));
```

### Swagger Annotations ÏƒÏ„Î¿Ï…Ï‚ Controllers
```javascript
/**
 * @swagger
 * /api/users:
 *   get:
 *     summary: Get all users
 *     description: Retrieve all users from the database (admin access required).
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: List of users
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 status:
 *                   type: boolean
 *                 data:
 *                   type: array
 *                   items:
 *                     type: object
 *                     properties:
 *                       username:
 *                         type: string
 *                       email:
 *                         type: string
 *                       roles:
 *                         type: array
 *                         items:
 *                           type: string
 *                       id:
 *                         type: string
 *       401:
 *         description: Unauthorized access (invalid or missing token)
 *       403:
 *         description: Forbidden access (non-admin role)
 *       500:
 *         description: Internal server error
 *     tags:
 *       - Users
 */
exports.findAll = async (req,res) => {
```

ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Swagger ÏƒÏ„Î¿ http://localhost:3000/api-docs/#/

## Middleware Î³Î¹Î± Role-Based Access Control

### middleware/verification.middleware.js
```javascript
// middleware/verification.middleware.js

const authService = require('../services/auth.service');
const logger = require('../logger/logger');

/**
 * Middleware to verify JWT token.
 * Attaches decoded user data to `req.user` if valid.
 */
const verifyToken = (req, res, next) => {
  const token = authService.getTokenFrom(req);
  const verificationResult = authService.verifyAccessToken(token);

  if (!verificationResult.verified) {
    logger.warn(`Unauthorized access attempt with token: ${token}`);
    return res.status(401).json({
      status: false,
      error: verificationResult.data
    });
  }

  req.user = verificationResult.data;
  next();
};

/**
 * Middleware to check if user has required role.
 * Call after verifyToken middleware.
 */
const checkRole = (requiredRole) => {
  return (req, res, next) => {
    const user = req.user;

    if (!user || !user.roles.includes(requiredRole)) {
      logger.warn(`Forbidden access by user: ${user?.username || 'unknown'}`);
      return res.status(403).json({
        status: false,
        error: 'Forbidden'
      });
    }

    next();
  };
};

module.exports = {
  verifyToken,
  checkRole
};
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
exports.findAll = async (req,res) => {
  const results = await User.find()
  res.json({
    status: true,
    data: results
  })
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.routes.js
```javascript
const { verifyToken, checkRole } = require('../middleware/verification.middleware');
router.get ('/', verifyToken, checkRole('admin'), userController.findAll)
```

## Î•Ï€ÏŒÎ¼ÎµÎ½Î± Î’Î®Î¼Î±Ï„Î±

1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Jest/Supertest unit ÎºÎ±Î¹ integration tests Î³Î¹Î± `/api/login` ÎºÎ±Î¹ `/api/users`
2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± minimal admin panel Î³Î¹Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½ (CRUD frontend Î³Î¹Î± `/api/users`)
3. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Î¿Ï… token ÏƒÏ„Î·Î½ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î¼Î½Î®Î¼Î· Ï„Î¿Ï… browser
4. Î£ÏÎ½Î´ÎµÏƒÎ· frontend Î¼Îµ server
5. ÎœÎµ router-dom ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± users

# ÎŸÎ´Î·Î³ÏŒÏ‚ Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Full Stack Î¼Îµ Node.js ÎºÎ±Î¹ React

## Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Server Î±Ï€ÏŒ App

### Î‘ÏÏ‡Î¹ÎºÎ® ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· server.js

```javascript
require('dotenv').config()
require('express-async-errors')
const url = require('url');
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const authRoutes = require('./routes/auth.routes.js')
const { log } = require('winston')
const logger = require('./logger/logger.js');
const swaggerSpec = require('./swagger.js');
const swaggerUI = require('swagger-ui-express')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ‰
app.use(express.json());
// Set up Swagger UI endpoint
app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec));

mongoose.set('strictQuery', false)
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    // console.log('connected to MongoDB', process.env.MONGODB_URI)
    console.log('connected to MongoDB')
  })
  .catch((error) => {
    console.log('error connecting to MongoDB:', error.message)
  })

app.use((req, res, next) => {
  const pathname = url.parse(req.originalUrl).pathname;
  logger.info(${req.method} ${pathname});
  next();
});

app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
app.use('/api/auth', authRoutes)

// Start the server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(Server running on port ${PORT});
});

module.exports = app
```

### Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏƒÎµ Î”ÏÎ¿ Î‘ÏÏ‡ÎµÎ¯Î±

#### ÎÎ­Î¿ server.js
```javascript
require('dotenv').config();
const mongoose = require('mongoose');
const app = require('./app'); // import the Express app from app.js

mongoose.set('strictQuery', false);
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    console.log('connected to MongoDB');
    const PORT = process.env.PORT || 3000;
    app.listen(PORT, () => {
      console.log(`Server running on port ${PORT}`);
    });
  })
  .catch((error) => {
    console.error('error connecting to MongoDB:', error.message);
  });
```

#### ÎÎ­Î¿ app.js
```javascript
require('dotenv').config()
require('express-async-errors')
const url = require('url');
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const authRoutes = require('./routes/auth.routes.js')
const { log } = require('winston')
const logger = require('./logger/logger.js');
const swaggerSpec = require('./swagger.js');
const swaggerUI = require('swagger-ui-express')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ‰
app.use(express.json());
app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec)); // Set up Swagger UI endpoint
app.use((req, res, next) => {
  const pathname = url.parse(req.originalUrl).pathname;
  logger.info(`${req.method} ${pathname}`);
  next();
});

app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
app.use('/api/auth', authRoutes)

module.exports = app
```

## Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Jest/Supertest Î³Î¹Î± Unit ÎºÎ±Î¹ Integration Tests

### Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Ï‰Î½ Ï€Î±ÎºÎ­Ï„Ï‰Î½
```bash
npm install --save-dev jest 
npm install --save-dev supertest
npm install --save-dev cross-env
npm install --save-dev dotenv
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Jest ÏƒÏ„Î¿ package.json
```json
"jest": {
  "collectCoverage":true,
  "coveragePathIgnorePatterns": [
    "/node_modules/",
    "/logs"
  ],
  "setupFiles": [
    "dotenv/config"
  ]
},
"scripts": {
  "test": "cross-env NODE_ENV=test jest --testTimeout=50000"
}
```

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± .env Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î³Î¹Î± test
```
MONGODB_TEST_URI = mongodb+srv://alkisax:{password}@cluster0.8ioq6.mongodb.net/loginAPP_TEST?retryWrites=true&w=majority&appName=Cluster0
```

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Test Î³Î¹Î± Login (__test__/login.test.js)
```javascript
const mongoose = require("mongoose");
const request = require("supertest");
const bcrypt = require("bcrypt");
const app = require("../app");

const User = require("../models/users.models");
const authService = require("../services/auth.service");

const TEST_USER = {
  username: "testuser",
  name: "Test User",
  email: "testuser@example.com",
  password: "testpassword",
  roles: ["admin"]
};

beforeEach(async () => {
  await mongoose.connect(process.env.MONGODB_TEST_URI);
  await User.deleteMany({});

  const saltRounds = 10;
  const hashedPassword = await bcrypt.hash(TEST_USER.password, saltRounds)

  await User.create({
    username: TEST_USER.username,
    name: TEST_USER.name,
    email: TEST_USER.email,
    hashedPassword: hashedPassword,
    roles: TEST_USER.roles
  })
})

afterEach(async () => {
  await mongoose.connection.close();
})

afterAll(async () => {
  await mongoose.disconnect();
})

describe("POST /api/login", () => {
  it("should return a valid token and user data when credentials are correct", async () => {
    const res = await request(app)
      .post("/api/login")
      .send({
        username: TEST_USER.username,
        password: TEST_USER.password
      });

    expect(res.statusCode).toBe(200);
    expect(res.body.status).toBe(true);
    expect(res.body.data.token).toBeDefined();
    expect(res.body.data.user).toMatchObject({
      username: TEST_USER.username,
      email: TEST_USER.email,
      roles: TEST_USER.roles
    });
  });
});
```

## ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® ÏƒÎµ DTO DAO Pattern

### Data Access Object (DAO)
#### daos/user.dao.js
```javascript
const User = require('../models/users.models');

const findAllUsers = async () => {
  return await User.find();
};

const findUserByUsername = async (username) => {
  return await User.findOne({ username });
};

const findUserByEmail = async (email) => {
  return await User.findOne({ email });
};

const createUser = async (userData) => {
  const user = new User(userData);
  return await user.save();
};

module.exports = {
  findAllUsers,
  findUserByUsername,
  findUserByEmail,
  createUser
};
```

### Î‘Î»Î»Î±Î³Î­Ï‚ ÏƒÏ„Î¿ user.controller.js
```javascript
const userDAO = require('../daos/user.dao')

exports.findAll = async (req, res) => {
  // transfer to dao
  // res.json({
  //   status: true,
  //   data: results
  // })
  const users = await userDAO.findAllUsers();
  res.json({ status: true, data: users });
}

exports.create = async (req, res) => {
  // ...
  // const newUser = new User({
  //   username: username,
  //   name: name,
  //   hashedPassword: hashedPassword,
  //   email: email,
  //   roles: roles
  // })
  // await newUser.save()
  const newUser = await userDAO.createUser({
    username,
    name,
    email,
    roles,
    hashedPassword
  });
  // ...
}
```

### Î‘Î»Î»Î±Î³Î­Ï‚ ÏƒÏ„Î¿ auth.controller.js
```javascript
const userDAO = require('../daos/user.dao')

// const user = await User.findOne({username: req.body.username})
const user = await userDAO.findUserByUsername(req.body.username);
```

### Data Transfer Object (DTO) - Î—Î¼Î¹Ï„ÎµÎ»Î­Ï‚
#### dtos/user.dto.js
```javascript
const toUserDTO = (user) => {
  return {
    id: user._id,
    username: user.username,
    email: user.email,
    name: user.name,
    roles: user.roles,
    createdAt: user.createdAt,
    updatedAt: user.updatedAt
  };
};

module.exports = {
  toUserDTO
};
```

## Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Tests

### Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ auth.controller.js Î³Î¹Î± ÎˆÎ»ÎµÎ³Ï‡Î¿ ÎšÎµÎ½ÏÎ½ Î ÎµÎ´Î¯Ï‰Î½
```javascript
exports.login = async (req, res) => {
  try {
    const username = req.body.username
    const password = req.body.password

    if (!username) {
      logger.warn("Login attempt missing username");
      return res.status(400).json({
        status: false,
        message: "Username is required"
      });
    }
    
    if (!password) {
      logger.warn("Login attempt missing password");
      return res.status(400).json({
        status: false,
        message: "Password is required"
      });
    }
    // ...
```

### Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Test Cases Î³Î¹Î± Login
```javascript
it("should fail with wrong password", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      username: TEST_USER.username,
      password: "wrongpassword"
    });

  expect(res.statusCode).toBe(401);
  expect(res.body.status).toBe(false);
  expect(res.body.message).toBe("Invalid username or password");
});

it("should fail with non-existent username", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      username: "notARealUser",
      password: "anyPassword"
    });

  expect(res.statusCode).toBe(401);
  expect(res.body.status).toBe(false);
  expect(res.body.message).toBe("Invalid username or password");
});

it("should fail when username is missing", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      password: TEST_USER.password
    });

  expect(res.statusCode).toBe(400); // you may need to validate and return 400 for bad input
  expect(res.body.status).toBe(false);
});

it("should fail when password is missing", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      username: TEST_USER.username
    });

  expect(res.statusCode).toBe(400); // same here
  expect(res.body.status).toBe(false);
});
```

## Î£ÏÎ½Î´ÎµÏƒÎ· Frontend Î¼Îµ Server

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î”Î¿ÎºÎ¹Î¼Î±ÏƒÏ„Î¹ÎºÎ¿Ï API Endpoint Î³Î¹Î± Message
#### message.controller.js
```javascript
/**
 * @swagger
 * /api/message:
 *   get:
 *     summary: Get a welcome message from the server
 *     description: Returns a simple "Hello from the server" message
 *     responses:
 *       200:
 *         description: A welcome message
 *       500:
 *         description: Internal server error
 *     tags:
 *       - Message
 */
exports.message = (req, res) => {
  try {
    res.status(200).json({
      status: true,
      message: "Hello from the server!"
    });
  } catch (error) {
    res.status(500).json({
      status: false,
      error: "Internal server error"
    });
  }
}
```

#### message.routes.js
```javascript
const express = require('express')
const router = express.Router()
const messageController = require('../controllers/message.controller')

router.get ('/', messageController.message)

module.exports = router
```

#### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ app.js
```javascript
const messageRoutes = require('./routes/message.routes.js')
app.use('/api/message', messageRoutes)
```

### Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· API ÏƒÏ„Î¿ React App
#### app.jsx
```javascript
const [message, setMessage] = useState('')

useEffect(() => {
  axios.get('http://localhost:3000/api/message')
    .then(res => setMessage(res.data.message))
    .catch(err => console.error(err));
}, [])

return (
  <div>
    <h1>{message}</h1>
    {/* ... */}
  </div>
)
```

### Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Login Form ÎºÎ±Î¹ Frontend Authentication
#### app.jsx
```javascript
const url = 'http://localhost:3000/api'

const [username, setUsername] = useState('')
const [password, setPassword] = useState('')
const [userIsAdmin, setUserIsAdmin] = useState(false)

const handleLogin = async (event) => {
  event.preventDefault()
  console.log("Submitting login...")

  try {
    const response = await axios.post(`${url}/login`, {
      "username": username,
      "password": password
    })
    console.log("Login successful", response.data)
    const { token, user } = response.data.data
    setUser(user)
    localStorage.setItem("token", token)
    localStorage.setItem("roles", JSON.stringify(user.roles))

    const isAdmin = user.roles.includes("admin")
    setUserIsAdmin(isAdmin)
    console.log("Is admin?", isAdmin)

  } catch (error) {
    console.log(error)     
  }
}

// Î£Ï„Î¿ return
{user === null && 
  <LoginForm 
    username={username}
    password={password}
    setUsername={setUsername}
    setPassword={setPassword}
    handleLogin={handleLogin}
  />}
```

### Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Logout
#### userLogedInView.jsx
```javascript
const UserLogedInView = ({ handleLogout }) => {
  return (
    <>
      <h1>Welcome user</h1>
      <button onClick={handleLogout}>log out</button>
    </>
  )
}
export default UserLogedInView
```

#### app.jsx
```javascript
const handleLogout = async () => {
  localStorage.removeItem("token")
  setUser(null)
  setUserIsAdmin(false)
  console.log("Logged out successfully")
}

// Î£Ï„Î¿ return
{user !==  null && 
  <UserLogedInView 
    handleLogout={handleLogout}
  />}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Admin Button ÏƒÏ„Î¿ UserLoggedInView
```javascript
// userLogedInView.jsx
{userIsAdmin &&
  <button onClick={handleAdminBtn}>admin panel</button> 
}

// app.jsx
<UserLogedInView 
  handleLogout={handleLogout}
  userIsAdmin={userIsAdmin}
  handleAdminBtn={handleAdminBtn}
/>
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Admin Panel

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î’Î±ÏƒÎ¹ÎºÎ¿Ï Admin Panel Component
#### frontend/src/components/AdminPanel.jsx
```javascript
const AdminPanel = () => {
  return (
    <div>
      <h2>Admin Panel</h2>
      <p>Only admins can see this.</p>
    </div>
  )
}

export default AdminPanel
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· React Router
#### main.jsx
```javascript
import { BrowserRouter as Router } from 'react-router-dom'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <Router>
      <App />
    </Router>
  </StrictMode>,
)
```

#### app.jsx
```javascript
import {
  BrowserRouter as Router,
  Routes, Route, Link, useNavigate
} from 'react-router-dom'

import AdminPanel from './components/AdminPanel'

const navigate = useNavigate()

const handleAdminBtn = () => {
  navigate("/admin")   
}

return (
  <div>
    <h6>{message}</h6>
    <h1>Login APP</h1>

    {/* Routes here handle sub-pages like /admin */}
    <Routes>
      <Route path="/" element={
        <>
          {user === null && 
          <LoginForm 
            username={username}
            password={password}
            setUsername={setUsername}
            setPassword={setPassword}
            handleLogin={handleLogin}
          />}
          {user !==  null && 
          <UserLogedInView 
            handleLogout={handleLogout}
            userIsAdmin={userIsAdmin}
            handleAdminBtn={handleAdminBtn}
          />}
        </>
      } /> 
      <Route path="/admin" element={<AdminPanel />} />        
    </Routes>
  </div>
)
```

### Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ Admin Panel ÎœÏŒÎ½Î¿ Î³Î¹Î± Admins
#### src/services/ProtectedRoute.js
```javascript
import { Navigate } from 'react-router-dom';

const ProtectedRoute = ({ user, children, requiredRole }) => {
  if (!user) {
    return <Navigate to="/" />;
  }

  if (requiredRole && !user.roles.includes(requiredRole)) {
    return <Navigate to="/" />;
  }

  return children;
};

export default ProtectedRoute;
```

#### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÏ„Î¿ App.jsx Î³Î¹Î± Ï„Î¿ Admin Route
```javascript
<Route path="/admin" element={
  <>
    <ProtectedRoute user={user} requiredRole="admin"></ProtectedRoute>
    <AdminPanel/>
  </>
} />
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î§ÏÎ®ÏƒÏ„Î· Î±Ï€ÏŒ Ï„Î¿ Admin Panel

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· URL ÏƒÏ„Î¿ AdminPanel
```javascript
// App.jsx
<Route path="/admin" element={
  <>
    <ProtectedRoute user={user} requiredRole="admin"></ProtectedRoute>
    <AdminPanel
      url={url}
    />
  </>
} />
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… AdminPanel.jsx
```javascript
import NewUserForm from './NewUserForm'
const AdminPanel = ({url}) => {
  // ...
  return (
    <div>
      {/* ... */}
      <button onClick={() => setViewForm(!viewForm)}>create user form</button>
      {viewForm && <NewUserForm url={url} />}
      {/* ... */}
    </div>
  )
}
```

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± NewUserForm.jsx
```javascript
import {useState} from 'react'
import axios from 'axios'

const NewUserForm = ({ url }) => {
  const [username, setUsername] = useState('')
  const [name, setName] = useState('')
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [roles, setRoles] = useState(['user'])

  const handleSubmitUser = async (event) => {
    event.preventDefault()
    
    try {
      const newUser = {
        "username": username,
        "name": name,
        "email": email,
        "password": password,
        "roles": roles
      }

      const response = await axios.post(`${url}/users`, newUser)

      console.log('âœ… User created:', response.data)
      alert('User created successfully!')

      // Clear the form if needed
      setUsername('')
      setName('')
      setEmail('')
      setPassword('')
      setRoles(['user'])

    } catch (error) {
      console.error('Error creating user:', error)
    }
  }

  return (
    <>
      <form onSubmit={handleSubmitUser}>
        <div>
          username
          <input type="text"
          value={username}
          name="username"
          onChange={({target}) => setUsername(target.value)}
          autoComplete="username"
          />
        </div>
        <div>
          name
          <input type="text"
          value={name}
          name="name"
          onChange={({target}) => setName(target.value)}
          autoComplete="name"
          />
        </div>
        <div>
          email
          <input type="email"
          value={email}
          name="email"
          onChange={({target}) => setEmail(target.value)}
          autoComplete="email"
          />
        </div>
        <div>
          <label>
            <input
              type="checkbox"
              value="admin"
              checked={roles.includes('admin')}
              onChange={({ target }) => {
                if (target.checked) {
                  setRoles([...roles, 'admin'])
                } else {
                  setRoles(roles.filter(r => r !== 'admin'))
                }
              }}
            />
            Admin
          </label>
        </div>      
        <div>
          password
          <input type="text"
          value={password}
          name="password"
          onChange={({target}) => setPassword(target.value)}
          autoComplete="password"
          />
        </div>
        <button type="submit">submit</button>
      </form>
    </>
  )
}
export default NewUserForm
```

## Remember Login
### Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Î£ÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Îµ Local Storage
```javascript
// App.jsx
useEffect(() => {
  const token = localStorage.getItem("token")
  const roles = JSON.parse(localStorage.getItem("roles"))
  if (token && roles) {
    const userFromStorage = { token, roles }
    setUser(userFromStorage) 
    setUserIsAdmin(roles.includes("admin")) 
  }
}, [])
```

## UI Improvements
### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Universal Logout Button
```javascript
// App.jsx
<h1>Login APP</h1>
{user && <button onClick={handleLogout}>log out</button>}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Home Button
```javascript
{/* Universal Home Button */}
<Link to="/" className="home-btn">
  <button>Home</button>
</Link>
```

## Î ÏÎ¿Î²Î¿Î»Î® Î§ÏÎ·ÏƒÏ„ÏÎ½ ÏƒÏ„Î¿ Admin Panel
### AdminPanel.jsx - Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ Î ÏÎ¿Î²Î¿Î»Î®Ï‚ Î§ÏÎ·ÏƒÏ„ÏÎ½
```javascript
import { useState, useEffect } from "react"
import axios from 'axios'

const AdminPanel = ({ url }) => {
  const [users, setUsers] = useState([]); 
  const [loading, setLoading] = useState(true);
  const [viewForm, setViewForm] = useState(false);

  useEffect(() => {
    const fetchUsers = async () => {
      try {
        const token = localStorage.getItem("token"); 
        const response = await axios.get(`${url}/users`, {
          headers: {
            Authorization: `Bearer ${token}`, 
          },
        });
        setUsers(response.data.data); 
        setLoading(false);
      } catch (error) {
        console.error("Error fetching users:", error);
        setLoading(false); 
      }
    };

    fetchUsers();
  }, [url]);

  return (
    <div>
      <h2>Admin Panel</h2>
      <p>Only admins can see this.</p>
      {loading && <p>Loading...</p>}
      {!loading && users.length === 0 && <p>No users found</p>}
      <ul>
        {!loading && users.length !== 0 && 
          users.map((user) => {
            return (
              <li key={user.id}>
                {user.username} - {user.name} - {user.email} - {user.roles.join(", ")}
              </li>
            )
          })
        } 
      </ul>
      {/* ... */}
    </div>
  )
}
```

## Google Login Integration

### Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Î ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½ ÏƒÏ„Î¿ Backend
#### Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Î”Î¹Ï€Î»ÏÎ½ Routes ÏƒÏ„Î¿ app.js
```javascript
app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
// app.use('/api/auth', authRoutes) // Î‘Ï†Î±Î¹ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î´Î¹Ï€Î»ÏŒ route
app.use('/api/message', messageRoutes)
```

#### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· URL ÏƒÏ„Î¿ auth.routes.js
```javascript
// https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=http://localhost:3000/api/login/google/callback&response_type=code&scope=email%20profile&access_type=offline
```

#### Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Google OAuth Origins ÎºÎ±Î¹ Redirects
```
Authorized JavaScript origins
http://localhost:3000
http://localhost:5173

Authorized redirect URIs
http://localhost:3000/api/login/google/callback
http://localhost:5173/
```

#### Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· auth.controller.js Î³Î¹Î± Ï„Î¿ Google Login
```javascript
const jwt = require('jsonwebtoken');

exports.googleLogin = async(req, res) => {
  const code = req.query.code
  if (!code) {
    logger.warn('Auth code is missing during Google login attempt');
    res.status(400).json({status: false, data: "auth code is missing"})
  } 
  const { user, tokens } = await authService.googleAuth(code);

  if (!user || !user.email) {
    logger.warn('Google login failed or incomplete');
    return res.status(401).json({ status: false, data: "Google login failed" });
  }

  // ğŸ” Create token for your app (JWT etc.)
  const dbUser = await User.findOneAndUpdate(
    { email: user.email },
    { $setOnInsert: { email: user.email, name: user.name, roles: ['user'] } },
    { upsert: true, new: true }
  );

  const payload = { id: dbUser._id, roles: dbUser.roles };
  const token = jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: '1d' });

  return res.redirect(`http://localhost:5173/google-success?token=${token}&email=${dbUser.email}`);
}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Google Success Component ÏƒÏ„Î¿ Frontend
#### App.jsx
```javascript
import GoogleSuccess from './components/GoogleSuccess'

// ...
<Route path="/google-success" element={
  <GoogleSuccess setUser={setUser} setUserIsAdmin={setUserIsAdmin} />
} />
```

#### components/GoogleSuccess.jsx
```javascript
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

const GoogleSuccess = () => {
  const navigate = useNavigate();

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const email = params.get('email');

    if (token) {
      // Store the token (adjust storage if you prefer memory/Redux/etc.)
      localStorage.setItem('token', token);
      localStorage.setItem('email', email);

      // Redirect to dashboard or homepage
      navigate('/');
    } else {
      // Maybe show error
      navigate('/login');
    }
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return <div>Logging you in via Google...</div>;
};

export default GoogleSuccess;
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Google Login Button ÏƒÏ„Î¿ LoginForm
```javascript
// LoginForm.jsx
const googleUrl = 'https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=http://localhost:3000/api/login/google/callback&response_type=code&scope=email%20profile&access_type=offline'

// Î£Ï„Î¿ return
<a href={googleUrl}>
  <button type="button">Login with Google</button>
</a>
```

### Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· Google OAuth Library
```bash
npm install @react-oauth/google
```

#### main.jsx
```javascript
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter as Router } from 'react-router-dom'
import { GoogleOAuthProvider } from '@react-oauth/google'
import App from './App.jsx'

const googleClientId = '37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <Router>
    <GoogleOAuthProvider clientId={googleClientId}> 
      <App />
      </GoogleOAuthProvider>
    </Router>
  </StrictMode>,
)
```

#### App.jsx
```javascript
const handleGoogleLogin = (response) => {
  console.log("Google login response:", response);
  // Send the Google token to your backend for verification
  axios.post(`${url}/login/google/callback`, {
    code: response.code
  }).then(res => {
    // Handle successful Google login (set user, token, etc.)
    console.log("Google login successful", res.data);
  }).catch(err => {
    console.log("Google login error", err);
  });
};

// Î£Ï„Î¿ Route element
<LoginForm 
  username={username}
  password={password}
  setUsername={setUsername}
  setPassword={setPassword}
  handleLogin={handleLogin}
  handleGoogleLogin={handleGoogleLogin}
/>
```

#### LoginForm.jsx
```javascript
import { GoogleLogin } from '@react-oauth/google';

const LoginForm = ({ username, password, setUsername, setPassword, handleLogin, handleGoogleLogin }) => {
  // ...
  return (
    <>
      {/* ... */}
      <GoogleLogin
        onSuccess={handleGoogleLogin}
        onError={(error) => console.log("Google Login Error:", error)}
      />
      {/* ... */}
    </>
  )
}
```

## User Detail Page

### components/UserDetail.jsx
```javascript
import { useParams } from 'react-router-dom';

const UserDetail = () => {
  const { id } = useParams();  // Access the id from the route parameter
  
  return (
    <div>
      <h4>User Detail for ID: {id}</h4>
      {/* Fetch and display user details here */}
    </div>
  );
};

export default UserDetail;
```

### AdminPanel.jsx
```javascript
              <li key={user._id || `${user.username}-${user.email}`}>
                 <Link to={`/users/${user._id}`}>
                  {user.username}
                 </Link>
                 - {user.name} - {user.email} - {user.roles.join(", ")}
              </li>
```
### App.jsx
```javascript
          <Route path="/users" element={<AdminPanel url={url} />} />
          <Route path="/users/:id" element={<UserDetail />} />
```

# ÎµÏ€Î¹Ï€Î»Î­Ï‰Î½ user test Î¼Îµ jest ÏƒÏ„Î¿ backend Ï€Î¿Ï… Î®Ï„Î±Î½ ÎµÎºÏÎµÎ¼Î¼ÏŒÏ„Î·Ï„Î±
## Î±ÏÏ‡Î¹ÎºÎ± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ¬Î½Ï‰ Î±Î»Î»Î±Î³Î­Ï‚ ÏƒÏ„Î¿ user.controler.js AÏÏ‡Î¹ÎºÎ¬ Î®Ï„Î±Î½:
```javascript
exports.findAll = async (req,res) => {
  const users = await userDAO.findAllUsers();
  res.json({ status: true, data: users });
}
```

### Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î¿Îº Î±Î»Î»Î± Ï‡ÏÎµÎ¹Î¬Î¶Î¿Î¼Î±Î¹ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Î³Î¹Î± Î½Î± ÎºÎ±Î½Ï‰ Ï„ÎµÏƒÏ„ Î³Î¹Î± Î±Ï€Î¿Ï„Ï…Ï‡Î¯Î±, ÎºÎ±Î¹ Î³Î¯Î½ÎµÏ„Îµ 
```javascript
exports.findAll = async (req,res) => {
  try {

    if (!req.headers.authorization) {
      return res.status(401).json({ status: false, error: 'No token provided' });
    }

    const users = await userDAO.findAllUsers();
    res.status(200).json({ status: true, data: users });
  } catch (error) {
    console.error(error);
    res.status(500).json({ status: false, error: 'Internal server error' });
  }

  // const users = await userDAO.findAllUsers();
  // res.json({ status: true, data: users });
}
```

## Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Ï Ï„Î¿ users.test.js

```javascript
const mongoose = require("mongoose");
const request = require("supertest");
const bcrypt = require("bcrypt");
const app = require("../app");
const jwt = require('jsonwebtoken');
require('dotenv').config()
const User = require("../models/users.models");
const userDAO = require("../daos/user.dao");

const authService = require('../services/auth.service')
const loginRouter = require('../routes/auth.routes')

const TEST_USER_ADMIN = {
  username: "testuser",
  name: "Test User",
  email: "testuser@example.com",
  password: "testpassword",
  roles: ["admin"]
};

let token;

beforeAll(async () => {

  const saltrounds = 10
  const hashedPassword = await bcrypt.hash(TEST_USER_ADMIN.password, saltrounds);

  await mongoose.connect(process.env.MONGODB_TEST_URI);
  console.log("Connection to MongoDB established for Jest")

  await User.deleteMany({})

  await User.create({
    username: TEST_USER_ADMIN.username,
    name: TEST_USER_ADMIN.name,
    email: TEST_USER_ADMIN.email,
    hashedPassword: hashedPassword,
    roles: TEST_USER_ADMIN.roles
  })

  const res = await request(app)
  .post("/api/login")
  .send({
    username: TEST_USER_ADMIN.username,
    password: TEST_USER_ADMIN.password
  });
  token = res.body.data.token
  console.log("token:", token)
})

afterAll(async () => {
  await User.deleteMany({})
  await mongoose.connection.close();
});

describe('GET /api/users', () => {
  it('should return 200 and a list of users when authorized and is admin', async () => {
    const res = await request(app)
      .get('/api/users')
      .set('Authorization', `Bearer ${token}`);  // Pass the token

    expect(res.status).toBe(200);
    expect(res.body.status).toBe(true);
    expect(Array.isArray(res.body.data)).toBe(true);
    expect(res.body.data.length).toBeGreaterThan(0);
  });

  it('should return 400 when no token', async () => {
    const res = await request(app)
      .get('/api/users')

    expect(res.status).toBe(401);
    expect(res.body.status).toBe(false);
  })

  it('should return 403 when a non-admin user tries to access the users list', async () => {
    // Simulate a non-admin user login
    const nonAdminToken = 'some-fake-token-for-non-admin';

    const res = await request(app)
      .get('/api/users')
      .set('Authorization', `Bearer ${nonAdminToken}`);

    expect(res.status).toBe(401);
    expect(res.body.status).toBe(false);
  });
})

describe('POST /api/users', () => {
  it('should return 201 and the created user when valid data is provided', async () => {
    const newUser = {
      username: 'newuser',
      name: 'New User',
      email: 'newuser@example.com',
      password: 'password123',
      roles: ['user']
    };

    const res = await request(app)
      .post('/api/users')
      .send(newUser);

    expect(res.status).toBe(201);
    expect(res.body.username).toBe(newUser.username);
    expect(res.body.name).toBe(newUser.name);
    expect(res.body.email).toBe(newUser.email);
    expect(res.body.roles).toEqual(newUser.roles);
  });

  it('should return 400 when required fields are missing', async () => {
    const newUser = {
      username: 'newuser',
      // Missing name, email, password, roles
    };

    const res = await request(app)
      .post('/api/users')
      .send(newUser);

    expect(res.status).toBe(500);
  });

  it('should return 400 when username already exists', async () => {
    const newUser = {
      username: 'existinguser',
      name: 'Existing User',
      email: 'existinguser@example.com',
      password: 'password123',
      roles: ['user']
    };

    // First, create a user with this username
    await request(app)
      .post('/api/users')
      .send(newUser);

    // Try to create the user again
    const res = await request(app)
      .post('/api/users')
      .send(newUser);

    expect(res.status).toBe(400);
  });
});
```

## Ï†Ï„Î¹Î±Ï‡Î½Ï‰ Î±ÎºÏŒÎ¼Î± Ï„ÎµÏƒÏ„ Î³Î¹Î± Ï„Î¿ message.tes.js
```javascript
const request = require('supertest');
const app = require('../app'); // Your Express app

describe('GET /api/message', () => {
  it('should return 200 and a welcome message', async () => {
    const res = await request(app).get('/api/message');

    expect(res.status).toBe(200);
    expect(res.body).toEqual({
      status: true,
      message: "Hello from the server!!"
    });
  });
});
```

## Î‘Î»Î»Î±Î³Î® ÏƒÏ„Î¿ package.json
### ÎµÏ€Î·Î´Î® Ï„Î± Ï„Î± Ï„ÎµÏƒÏ„ Ï„Î¿ ÎºÎ±Î¸Î­Î½Î± Î¼Î¿Î½Î¿ Ï„Î¿Ï… Ï€Î­ÏÎ½Î±Î³Îµ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬ Î±Î»Î»Î¬ Î¿Î»Î± Î¼Î±Î¶Î¯ ÎºÎ¬Î½Î±Î½Îµ ÎºÎ¿Î½Ï†Î»Î¹ÎºÏ„ Ï€ÏÎ¿ÏƒÎ¸ÎµÏƒÎ± Ï„Î¿ **--runÎ™nBand** ÏƒÏ„Î¿ ÏƒÎºÏÎ¹Ï€Ï„ Ï‰ÏƒÏ„Îµ Î½Î± Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î­Î½Î± Î­Î½Î±
```javascript
    "test": "cross-env NODE_ENV=test jest --testTimeout=50000  --runInBand"
```

## Delete user
## user.dao.js (Î¸Î± Ï„Î¿ Ï‡ÏÎµÎ¹Î±ÏƒÏ„Ï ÏƒÎµ Î»Î¯Î³Î¿) Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰
```javascript
const deleteUserById = async (userId) => {
  return await User.findByIdAndDelete(userId)
}

module.exports = {
  findAllUsers,
  findUserByUsername,
  findUserByEmail,
  createUser,
  deleteUserById
};
```

## user.controller.js Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰
```javascript
exports.deleteById = async (req, res) => {
  const userId = req.params.id
  if (!userId){
    return res.status(400).json({
      status: false,
      error: 'User ID is required OR not found'
    })
  }
  try {
    const deleteUser = await userDAO.deleteUserById(userId) // to be added to user.dao.js
    if (!deleteUser){
      return res.status(404).json({
        status: false,
        error: 'Error deleting user: not found'
      })
    } else {
      res.status(200).json({
        status: true,
        message: `User ${deleteUser.username} deleted successfully`,
      })
    }
  } catch (error) {
    res.status(500).json({
      status: false,
      error: error.message
    })
  }
}
```
### Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î¿Ï… Î²Î¬Î»Ï‰ Î±Ï€Î¿ Ï€Î¬Î½Ï‰ ÎºÎ±Î¹ @swagger
```javascript
/**
 * @swagger
 * /api/users/{id}:
 *   delete:
 *     summary: Delete a user
 *     description: Admin only. Deletes a user by ID.
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *         description: User ID
 *     responses:
 *       200:
 *         description: User deleted
 *       400:
 *         description: Missing or invalid ID
 *       401:
 *         description: Unauthorized
 *       403:
 *         description: Forbidden
 *       404:
 *         description: User not found
 *       500:
 *         description: Server error
 */
```

## user.routes.js
```javascript
router.delete('/:id', verifyToken, checkRole('admin'), userController.deleteById)
```
### Î´Î¿ÎºÎ¹Î¼Î® Î¼Îµ postman ok
## Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· jest test ÏƒÏ„Î¿ users.test.js
```javascript
  it('creates a user and then deletes it', async () => {
    const newUser = {
      username: 'deleteme',
      name: 'deleteme',
      email: 'deleteme@example.com',
      password: '123',
      roles: ['user']
    };

    // First, create a user with this username
    const toBeDeletedUser = await request(app)
      .post('/api/users')
      .set('Authorization', `Bearer ${token}`)
      .send(newUser)
      .expect(201)

    // try to retrive user id
    const userId = toBeDeletedUser.body._id
    expect(userId).toBeDefined()

    await request(app)
      .delete(`/api/users/${userId}`)
      .set('Authorization', `Bearer ${token}`)
      .expect(200)
  });
  it('delete with no id expext 404', async () => {
    await request(app)
    .delete(`/api/users/`)
    .set('Authorization', `Bearer ${token}`)
    .expect(404)
  })
  it('delete with invalid id expect 404', async () => {
    const justAWrongId = '60c72b2f9b1e8b1a8b2a3c4d' //invalid id but valid mongo format
    await request(app)
    .delete(`/api/users/${justAWrongId}`)
    .set('Authorization', `Bearer ${token}`)
    .expect(404)
  })
  it('delete with invalid id expect 500', async () => {
    const justAWrongId = 'invalid id format' //invalid id and invalid mongo format
    await request(app)
    .delete(`/api/users/${justAWrongId}`)
    .set('Authorization', `Bearer ${token}`)
    .expect(500)
  })
```

## cypress tests


<!-- # ÎŸÎ´Î·Î³ÏŒÏ‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Full-Stack ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ Login Î¼Îµ MERN Stack

Î‘Ï…Ï„ÏŒÏ‚ Î¿ Î¿Î´Î·Î³ÏŒÏ‚ Ï€ÎµÏÎ¹Î³ÏÎ¬Ï†ÎµÎ¹ Î²Î®Î¼Î± Ï€ÏÎ¿Ï‚ Î²Î®Î¼Î± Ï„Î· Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î¼Î¹Î±Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ login Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¹Ï‚ Ï„ÎµÏ‡Î½Î¿Î»Î¿Î³Î¯ÎµÏ‚ Ï„Î¿Ï… MERN stack (MongoDB, Express, React, Node.js).

## Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î±
1. [Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Git Repository](#Î±ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·-git-repository)
2. [Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Frontend (React)](#ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·-ÎºÎ±Î¹-ÏÏÎ¸Î¼Î¹ÏƒÎ·-Ï„Î¿Ï…-frontend-react)
3. [Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Backend (Express)](#ÎµÎ³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·-ÎºÎ±Î¹-ÏÏÎ¸Î¼Î¹ÏƒÎ·-Ï„Î¿Ï…-backend-express)
4. [Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²Î±ÏƒÎ¹ÎºÎ®Ï‚ Î´Î¿Î¼Î®Ï‚ Ï„Î¿Ï… Backend](#Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±-Î²Î±ÏƒÎ¹ÎºÎ®Ï‚-Î´Î¿Î¼Î®Ï‚-Ï„Î¿Ï…-backend)
5. [Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Frontend Login Form](#Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±-Ï„Î¿Ï…-frontend-login-form)
6. [Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· CRUD Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½](#Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·-crud-Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½)
7. [Î”Î¿ÎºÎ¹Î¼Î® Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚](#Î´Î¿ÎºÎ¹Î¼Î®-Ï„Î·Ï‚-ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚)

## Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Git Repository

_Î•Î´Ï Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ ÎºÎ±Î¹ ÏƒÏ…Î½Î´Î­Î¿Ï…Î¼Îµ Ï„Î¿ Ï„Î¿Ï€Î¹ÎºÏŒ Î¼Î±Ï‚ repository Î¼Îµ Ï„Î¿ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ ÏƒÏ„Î¿ GitHub Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ ÎºÎ±Î¹ Î´Î¹ÎµÏ…ÎºÏŒÎ»Ï…Î½ÏƒÎ· Ï„Î·Ï‚ ÏƒÏ…Î½ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚._

```bash
# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï€Î¹ÎºÎ¿Ï repository
git init

# Î£ÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î¿ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ repository ÏƒÏ„Î¿ GitHub
git remote add origin git@github.com:alkisax/loginAPP.git

# Î›Î®ÏˆÎ· Ï„Î¿Ï… Ï€ÎµÏÎ¹ÎµÏ‡Î¿Î¼Î­Î½Î¿Ï… Î±Ï€ÏŒ Ï„Î¿ Î±Ï€Î¿Î¼Î±ÎºÏÏ…ÏƒÎ¼Î­Î½Î¿ repository
git pull origin main
```

## Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Frontend (React)

_Î£Îµ Î±Ï…Ï„ÏŒ Ï„Î¿ Î²Î®Î¼Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Ï„Î¿ React project Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Vite ÎºÎ±Î¹ ÎµÎ³ÎºÎ±Î¸Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚ Î³Î¹Î± Ï„Î¿ frontend Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚. Î¤Î¿ Redux Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÏ‰Î½, ÎµÎ½Ï Ï„Î¿ axios Î³Î¹Î± ÎµÏ€Î¹ÎºÎ¿Î¹Î½Ï‰Î½Î¯Î± Î¼Îµ Ï„Î¿ backend._

```bash
# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… React project Î¼Îµ Vite
npm create vite@latest frontend -- --template react

# ÎœÎµÏ„Î±ÎºÎ¯Î½Î·ÏƒÎ· ÏƒÏ„Î¿Î½ ÎºÎ±Ï„Î¬Î»Î¿Î³Î¿ Ï„Î¿Ï… frontend
cd frontend

# Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Ï‰Î½ Î²Î±ÏƒÎ¹ÎºÏÎ½ ÎµÎ¾Î±ÏÏ„Î®ÏƒÎµÏ‰Î½
npm install

# Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Ï„Ï‰Î½ ÎµÏ€Î¹Ï€ÏÏŒÏƒÎ¸ÎµÏ„Ï‰Î½ Î²Î¹Î²Î»Î¹Î¿Î¸Î·ÎºÏÎ½
npm install axios               # Î“Î¹Î± HTTP Î±Î¹Ï„Î®Î¼Î±Ï„Î±
npm install react-bootstrap     # Î“Î¹Î± ÏƒÏ„Ï…Î»Î¹ÏƒÏ„Î¹ÎºÎ¬ components
npm install redux               # Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÏ‰Î½
npm install react-redux         # Î£ÏÎ½Î´ÎµÏƒÎ· React Î¼Îµ Redux
npm install @reduxjs/toolkit    # Î•ÏÎ³Î±Î»ÎµÎ¯Î± Î³Î¹Î± Î±Ï€Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Ï‡ÏÎ®ÏƒÎ·Ï‚ Ï„Î¿Ï… Redux
```

## Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎºÎ±Î¹ ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Backend (Express)

_Î•Î´Ï Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Ï„Î¿ Express backend ÎºÎ±Î¹ ÎµÎ³ÎºÎ±Î¸Î¹ÏƒÏ„Î¿ÏÎ¼Îµ Ï„Î¹Ï‚ Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„ÎµÏ‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎµÏ‚. Î¤Î¿ mongoose Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î³Î¹Î± Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· MongoDB, Ï„Î¿ bcrypt Î³Î¹Î± ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎºÏ‰Î´Î¹ÎºÏÎ½, ÎºÎ±Î¹ Ï„Î¿ jsonwebtoken Î³Î¹Î± Ï„Î·Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·._

```bash
# Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†Î±ÎºÎ­Î»Î¿Ï… Î³Î¹Î± Ï„Î¿ backend (Î±Î½ Î´ÎµÎ½ Î²ÏÎ¹ÏƒÎºÏŒÎ¼Î±ÏƒÏ„Îµ Î®Î´Î· ÏƒÏ„Î¿Î½ Î³Î¿Î½Î¹ÎºÏŒ Ï†Î¬ÎºÎµÎ»Î¿)
cd ..

# Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Ï„Î¿Ï… Node.js project
npm init

# Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î²Î±ÏƒÎ¹ÎºÏÎ½ Î²Î¹Î²Î»Î¹Î¿Î¸Î·ÎºÏÎ½
npm install express             # Web framework
npm install mongoose            # MongoDB ODM
npm install dotenv              # Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚
npm install bcrypt              # ÎšÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎºÏ‰Î´Î¹ÎºÏÎ½
npm install jsonwebtoken        # Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· JWT tokens
npm install swagger-ui-express  # API documentation
npm install mongoose-to-swagger # ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® mongoose models ÏƒÎµ swagger schemas
npm install winston             # Logging
npm install winston-daily-rotate-file # Î ÎµÏÎ¹ÏƒÏ„ÏÎ¿Ï†Î® Î±ÏÏ‡ÎµÎ¯Ï‰Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®Ï‚
npm install winston-mongodb     # Logging ÏƒÏ„Î· MongoDB
npm install google-auth-library # Î‘Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ Google
npm install axios               # HTTP client
npm install react-router-dom    # Î”ÏÎ¿Î¼Î¿Î»ÏŒÎ³Î·ÏƒÎ· Î³Î¹Î± React
npm install cors                # Cross-Origin Resource Sharing
npm install morgan              # HTTP request logger
npm install express-async-errors # Î§ÎµÎ¹ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏƒÏ†Î±Î»Î¼Î¬Ï„Ï‰Î½ Î±ÏƒÏÎ³Ï‡ÏÎ¿Î½Ï‰Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½
npm install prop-types          # Type checking Î³Î¹Î± React props

# Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· ÎµÎ¾Î±ÏÏ„Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± Î±Î½Î¬Ï€Ï„Ï…Î¾Î·
npm install --save-dev nodemon  # Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î· ÎµÏ€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… server
npm install --save-dev supertest # Î“Î¹Î± testing HTTP
npm install --save-dev cross-env # Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Î¼ÎµÏ„Î±Î²Î»Î·Ï„ÏÎ½ Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚
npm install --save-dev jest @babel/preset-env @babel/preset-react eslint-plugin-jest # Î“Î¹Î± testing
npm install --save-dev deep-freeze # Î“Î¹Î± immutable objects ÏƒÏ„Î± tests
```

**Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·**: Î‘Î½ Î±Î½Ï„Î¹Î¼ÎµÏ„Ï‰Ï€Î¯ÏƒÎµÏ„Îµ Ï€ÏÏŒÎ²Î»Î·Î¼Î± Î¼Îµ Ï„Î¿ `express-async-errors`, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎºÎ¬Î½ÎµÏ„Îµ downgrade Ï„Î¿Ï… express:

```bash
npm install express@4
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î²Î±ÏƒÎ¹ÎºÎ®Ï‚ Î´Î¿Î¼Î®Ï‚ Ï„Î¿Ï… Backend

_Î£Îµ Î±Ï…Ï„Î® Ï„Î·Î½ ÎµÎ½ÏŒÏ„Î·Ï„Î± Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î· Î²Î±ÏƒÎ¹ÎºÎ® Î´Î¿Î¼Î® Ï„Î¿Ï… backend Î¼Îµ Ï„Î· ÏÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… server, Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· MongoDB ÎºÎ±Î¹ Ï„Î¿ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼ÏŒ Ï„Î¿Ï… API Î¼Î±Ï‚._

### 1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±ÏÏ‡ÎµÎ¯Î¿Ï… Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½Ï„Î¿Ï‚

_Î¤Î¿ .env Î±ÏÏ‡ÎµÎ¯Î¿ Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ ÎµÏ…Î±Î¯ÏƒÎ¸Î·Ï„ÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ ÏƒÏ…Î½Î´Î­ÏƒÎµÎ¹Ï‚ Î¼Îµ Î²Î¬ÏƒÎµÎ¹Ï‚ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï€Î¿Ï… Î´ÎµÎ½ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÎ¿Î½Ï„Î±Î¹ ÏƒÏ„Î¿ version control._

Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿ `.env` ÏƒÏ„Î¿Î½ ÎºÎµÎ½Ï„ÏÎ¹ÎºÏŒ Ï†Î¬ÎºÎµÎ»Î¿ Ï„Î¿Ï… backend:

```
MONGODB_URI = mongodb+srv://alkis:2102011895@cluster0.8ioq6.mongodb.net/loginAp?retryWrites=true&w=majority&appName=Cluster0
```

### 2. ÎŸÏÎ³Î¬Î½Ï‰ÏƒÎ· Ï„Î¿Ï… backend ÎºÏÎ´Î¹ÎºÎ±

_Î— ÏƒÏ‰ÏƒÏ„Î® Î¿ÏÎ³Î¬Î½Ï‰ÏƒÎ· Ï„Î¿Ï… ÎºÏÎ´Î¹ÎºÎ± ÎµÎ¯Î½Î±Î¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ® Î³Î¹Î± Ï„Î· ÏƒÏ…Î½Ï„Î·ÏÎ·ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± ÎºÎ±Î¹ Ï„Î·Î½ ÎµÏ€ÎµÎºÏ„Î±ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î± Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚._

Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿Ï…Ï‚ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î¿Ï…Ï‚ Ï†Î±ÎºÎ­Î»Î¿Ï…Ï‚:
- `models`: Î“Î¹Î± Ï„Î± mongoose models
- `controllers`: Î“Î¹Î± Ï„Î¿Ï…Ï‚ controllers Ï„Î¿Ï… API
- `routes`: Î“Î¹Î± Ï„Î± endpoints Ï„Î¿Ï… API
- `services`: Î“Î¹Î± Ï„Î·Î½ ÎµÏ€Î¹Ï‡ÎµÎ¹ÏÎ·Î¼Î±Ï„Î¹ÎºÎ® Î»Î¿Î³Î¹ÎºÎ® Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚

### 3. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· scripts ÏƒÏ„Î¿ package.json

_Î¤Î± scripts ÏƒÏ„Î¿ package.json Î´Î¹ÎµÏ…ÎºÎ¿Î»ÏÎ½Î¿Ï…Î½ Ï„Î·Î½ ÎµÎºÏ„Î­Î»ÎµÏƒÎ· ÏƒÏ…Ï‡Î½ÏÎ½ ÎµÏÎ³Î±ÏƒÎ¹ÏÎ½ ÏŒÏ€Ï‰Ï‚ Ï„Î·Î½ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… server._

Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ scripts ÏƒÏ„Î¿ `package.json`:

```json
"scripts": {
  "start": "node server.js",
  "dev": "node --watch server.js",
  "test": "echo \"Error: no test specified\" && exit 1"
}
```

### 4. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Î¼Î¿Î½Ï„Î­Î»Î¿Ï… User

_Î¤Î¿ Î¼Î¿Î½Ï„Î­Î»Î¿ User Î¿ÏÎ¯Î¶ÎµÎ¹ Ï„Î· Î´Î¿Î¼Î® Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ„Î· MongoDB ÎºÎ±Î¹ Ï€ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï€ÎµÎ´Î¯Î± Î³Î¹Î± Ï„Î¿ ÏŒÎ½Î¿Î¼Î± Ï‡ÏÎ®ÏƒÏ„Î· ÎºÎ±Î¹ Ï„Î¿Î½ ÎºÏ‰Î´Î¹ÎºÏŒ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚._

Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `models/users.models.js`:

```javascript
const mongoose = require("mongoose")
const Schema = mongoose.Schema
const userSchema = new Schema({
  username:{
    type: String,
    required: [true, 'username is required'],
    unique:true
  },
  password:{
    type: String,
    required: [true, 'password is required'],
  },
},
{
  collection: 'users',
  timestamps: true
})
module.exports = mongoose.model('User', userSchema)
```

### 5. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… User Controller

_ÎŸ controller Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¹Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ Ï€Î¿Ï… Ï‡ÎµÎ¹ÏÎ¯Î¶Î¿Î½Ï„Î±Î¹ Ï„Î± HTTP Î±Î¹Ï„Î®Î¼Î±Ï„Î± Î³Î¹Î± Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚._

Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `controllers/user.controller.js`:

```javascript
const User = require('../models/users.models')

exports.findAll = async (req,res) => {
 const results = await User.find()
 res.json(results)
}
```

### 6. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Ï‰Î½ User Routes

_Î¤Î± routes ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Ï…Î½ Ï„Î± URL endpoints ÎºÎ±Î¹ Ï„Î¿Ï…Ï‚ Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡Î¿Ï…Ï‚ controllers Î³Î¹Î± ÎºÎ¬Î¸Îµ HTTP Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±._

Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `routes/user.routes.js`:

```javascript
const express = require('express')
const router = express.Router()
const userController = require('../controllers/user.controller.js')

router.get ('/', userController.findAll)

module.exports = router
```

### 7. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… ÎºÎµÎ½Ï„ÏÎ¹ÎºÎ¿Ï server

_Î¤Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ server.js ÎµÎ¯Î½Î±Î¹ Ï„Î¿ ÏƒÎ·Î¼ÎµÎ¯Î¿ ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·Ï‚ Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚ backend ÎºÎ±Î¹ ÏÏ…Î¸Î¼Î¯Î¶ÎµÎ¹ Ï„Î¿ Express, Ï„Î· ÏƒÏÎ½Î´ÎµÏƒÎ· Î¼Îµ Ï„Î· MongoDB, ÎºÎ±Î¹ Ï„Î± routes._

Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ„Îµ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿ `server.js`:

```javascript
require('dotenv').config()
require('express-async-errors')
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const { log } = require('winston')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î³Î¹Î± ÏƒÎµÏÎ²Î¯ÏÎ¹ÏƒÎ¼Î± Ï„Î¿Ï… React build
app.use(express.json());

mongoose.set('strictQuery', false)
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    console.log('connected to MongoDB')
  })
  .catch((error) => {
    console.log('error connecting to MongoDB:', error.message)
  })

app.use('/api/users', userRoutes)

// Î•ÎºÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

module.exports = app
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Frontend Login Form

_Î¤Î¿ login form ÎµÎ¯Î½Î±Î¹ Ï„Î¿ Î²Î±ÏƒÎ¹ÎºÏŒ ÏƒÏ…ÏƒÏ„Î±Ï„Î¹ÎºÏŒ Ï„Î¿Ï… frontend ÎºÎ±Î¹ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚ Î½Î± ÎµÎ¹ÏƒÎ¬Î³Î¿Ï…Î½ Ï„Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± Ï„Î¿Ï…Ï‚._

```jsx
return (
  <>
    <form onSubmit={handleLogin}>
      <div>
        username
        <input type="text"
        value={username}
        name="username"
        onChange={({target}) => setUsername(target.value)}
        autoComplete="username"
        />
      </div>
      <div>
        password
        <input type="text"
        value={password}
        name="password"
        onChange={({target}) => setPassword(target.value)}
        autoComplete="password"
        />
      </div>
      <button type="submit">Login</button>
    </form>
  </>
)
```

## Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· CRUD Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÏÎ½

_Î“Î¹Î± Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î·Î½ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®, Ï‡ÏÎµÎ¹Î±Î¶ÏŒÎ¼Î±ÏƒÏ„Îµ Ï„Î· Î´Ï…Î½Î±Ï„ÏŒÏ„Î·Ï„Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Ï‡ÏÎ·ÏƒÏ„ÏÎ½, Ï€Î¿Ï… Î±Ï€Î±Î¹Ï„ÎµÎ¯ Ï„Î·Î½ Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î·Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ POST._

### 1. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î·Ï‚ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Ï‡ÏÎ®ÏƒÏ„Î· ÏƒÏ„Î¿Î½ controller

_Î‘Ï…Ï„Î® Î· Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î± ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÏƒÏ„Î· Î²Î¬ÏƒÎ· Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½._

Î ÏÎ¿ÏƒÎ¸Î­ÏƒÏ„Îµ Ï„Î·Î½ Î±ÎºÏŒÎ»Î¿Ï…Î¸Î· Î¼Î­Î¸Î¿Î´Î¿ ÏƒÏ„Î¿ `controllers/user.controller.js`:

```javascript
exports.create = async (req,res) => {
  const username = req.body.username
  const password = req.body.password

  // Î•Î´Ï Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸ÎµÎ¯ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î­Î»ÎµÎ³Ï‡Î¿Ï‚ Î¼Îµ if

  try {
    const newUser = new User({
      username: username,
      password: password
    })
    await newUser.save()
    res.status(201).json(newUser)
  } catch(error) {
    res.status(400).json('error', error.message)
  }
}
```

### 2. Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… Î±Î½Ï„Î¯ÏƒÏ„Î¿Î¹Ï‡Î¿Ï… route

_Î¤Î¿ route Î³Î¹Î± Ï„Î· Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï‡ÏÎ·ÏƒÏ„ÏÎ½ Î±Î½Ï„Î¹ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯ ÏƒÏ„Î¿ HTTP POST request._

Î•Î½Î·Î¼ÎµÏÏÏƒÏ„Îµ Ï„Î¿ `routes/user.routes.js`:

```javascript
router.get('/', userController.findAll)
router.post('/', userController.create)
```

## Î”Î¿ÎºÎ¹Î¼Î® Ï„Î·Ï‚ ÎµÏ†Î±ÏÎ¼Î¿Î³Î®Ï‚

_Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î¿ Postman, Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´Î¿ÎºÎ¹Î¼Î¬ÏƒÎ¿Ï…Î¼Îµ Ï„Î± API endpoints Î¼Î±Ï‚ Î³Î¹Î± Î½Î± Î²ÎµÎ²Î±Î¹Ï‰Î¸Î¿ÏÎ¼Îµ ÏŒÏ„Î¹ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¿ÏÎ½ ÏƒÏ‰ÏƒÏ„Î¬._

1. ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Ï„Î¿ server:
   ```bash
   npm run dev
   ```

2. ÎœÎµ Ï„Î¿ Postman, ÏƒÏ„ÎµÎ¯Î»Ï„Îµ Î­Î½Î± POST request ÏƒÏ„Î¿ `http://localhost:3000/api/users` Î¼Îµ Î­Î½Î± JSON ÏƒÏÎ¼Î± ÏŒÏ€Ï‰Ï‚:
   ```json
   {
     "username": "testuser",
     "password": "testpassword"
   }
   ```

3. Î•Ï€Î¹Î²ÎµÎ²Î±Î¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Ï€ÎµÏÎ¹Î­Ï‡ÎµÎ¹ Ï„Î¿Î½ Î½Î­Î¿ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Î­Î½Î± ID Î±Ï€ÏŒ Ï„Î· MongoDB.

4. Î£Ï„ÎµÎ¯Î»Ï„Îµ Î­Î½Î± GET request ÏƒÏ„Î¿ `http://localhost:3000/api/users` Î³Î¹Î± Î½Î± Î´ÎµÎ¯Ï„Îµ ÏŒÎ»Î¿Ï…Ï‚ Ï„Î¿Ï…Ï‚ Ï‡ÏÎ®ÏƒÏ„ÎµÏ‚.

## Î•Ï€ÏŒÎ¼ÎµÎ½Î± Î²Î®Î¼Î±Ï„Î±

ÎœÎµÏ„Î¬ Î±Ï€ÏŒ Î±Ï…Ï„Î® Ï„Î· Î²Î±ÏƒÎ¹ÎºÎ® Ï…Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ·, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î±:

1. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ ÎºÏÏ…Ï€Ï„Î¿Î³ÏÎ¬Ï†Î·ÏƒÎ· ÎºÏ‰Î´Î¹ÎºÏÎ½ Î¼Îµ bcrypt
2. Î¥Î»Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ JWT Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
3. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î± middleware Î³Î¹Î± Ï„Î·Î½ Ï€ÏÎ¿ÏƒÏ„Î±ÏƒÎ¯Î± Ï„Ï‰Î½ routes
4. Î£Ï…Î½Î´Î­ÏƒÎµÏ„Îµ Ï„Î¿ frontend Î¼Îµ Ï„Î¿ backend
5. Î ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÏ„Îµ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯ÎµÏ‚ ÏŒÏ€Ï‰Ï‚ reset password

ÎšÎ±Î»Î® Î±Î½Î¬Ï€Ï„Ï…Î¾Î·! -->