# ÎŸÎ´Î·Î³Î¯ÎµÏ‚ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Login Application

## Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Git
```bash
git init
git remote add origin git@github.com:alkisax/loginAPP.git
git pull origin main
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Frontend (Vite)
```bash
npm create vite@latest frontend -- --template react
npm install
npm install axios
npm install react-bootstrap
npm install react-router-dom
npm install redux
npm install react-redux
npm install @reduxjs/toolkit
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Backend
```bash
npm init
npm install express
npm install mongoose
npm install dotenv
npm install bcrypt
npm install jsonwebtoken
npm install swagger-ui-express
npm install mongoose-to-swagger
npm install swagger-jsdoc
npm install winston
npm install winston-daily-rotate-file
npm install winston-mongodb
npm install google-auth-library
npm install axios
npm install cors
npm install morgan
npm install express-async-errors
npm install --save-dev nodemon
npm install --save-dev supertest
npm install --save-dev cross-env
npm install prop-types
npm install --save-dev jest @babel/preset-env @babel/preset-react eslint-plugin-jest
npm install --save-dev deep-freeze
```

**Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·**: Î•Ï€ÎµÎ¹Î´Î® Ï…Ï€Î®ÏÎ¾Îµ conflict Î¼Îµ Ï„Î¿ express-async-errors, Î­Î³Î¹Î½Îµ downgrade ÏƒÏ„Î¿ express:
```bash
npm install express@4
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Login Form
```jsx
return (
  <>
    <form onSubmit={handleLogin}>
      <div>
        username
        <input type="text"
        value={username}
        name="username"
        onChange={({target}) => setUsername(target.value)}
        autoComplete="username"
        />
      </div>
      <div>
        password
        <input type="text"
        value={password}
        name="password"
        onChange={({target}) => setPassword(target.value)}
        autoComplete="password"
        />
      </div>
    </form>
  </>
)
```

## Custom View ÏƒÏ„Î¿ Frontend

Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Ï„Î¿Ï… component `userLogedInView.jsx`:
```jsx
const UserLogedInView = () => {
  return (
    <>
      <h1>Welcome user</h1>
    </>
  )
}
export default UserLogedInView
```

Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… `App.jsx`:
```jsx
import UserLogedInView from './components/userLogedInView'

const App = () => {
  const [user, setUser] = useState(null)

  return (
    <div>
      <h1>Login APP</h1>
      {user === null && <LoginForm />}
      {user !==  null && <UserLogedInView />}
    </div>
  )
}
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î’Î±ÏƒÎ¹ÎºÎ¿Ï CRUD ÏƒÏ„Î¿ Backend

Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· scripts ÏƒÏ„Î¿ `package.json`:
```json
"scripts": {
  "start": "node server.js",
  "dev": "node --watch server.js",
  "test": "echo \"Error: no test specified\" && exit 1"
}
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± .env
```
MONGODB_URI = mongodb+srv://alkis:{password}@cluster0.8ioq6.mongodb.net/loginAp?retryWrites=true&w=majority&appName=Cluster0
```

## ÎŸÏÎ³Î¬Î½Ï‰ÏƒÎ· Î¦Î±ÎºÎ­Î»Ï‰Î½
Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï†Î±ÎºÎ­Î»Ï‰Î½: routes, models, controllers, services

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Models

### users.models.js
```javascript
const mongoose = require("mongoose")
const Schema = mongoose.Schema
const userSchema = new Schema({
  username:{
    type: String,
    required: [true, 'username is required'],
    unique:true
  },
  name:{
    type: String,
    required: false
  },
  roles:{
    type: [String],
    default: ['user']
  },
  email:{
    type: String,
    required: false,
    unique: true
  },
  password:{
    type: String,
    required: [true, 'password is required'],
  },
},
{
  collection: 'users',
  timestamps: true
})
module.exports = mongoose.model('User', userSchema)
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Controllers

### user.controller.js
```javascript
const User = require('../models/users.models')

exports.findAll = async (req,res) => {
 const results = await User.find()
 res.json(results)
}
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Routes

### user.routes.js
```javascript
const express = require('express')
const router = express.Router()
const userController = require('../controllers/user.controller.js')

router.get ('/', userController.findAll)

module.exports = router
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Server

### server.js
```javascript
require('dotenv').config()
require('express-async-errors')
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const { log } = require('winston')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ‰
app.use(express.json());

mongoose.set('strictQuery', false)
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    // console.log('connected to MongoDB', process.env.MONGODB_URI)
    console.log('connected to MongoDB')
  })
  .catch((error) => {
    console.log('error connecting to MongoDB:', error.message)
  })

app.use('/api/users', userRoutes)

// Start the server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

module.exports = app
```

## Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î±Ï‚ Î§ÏÎ®ÏƒÏ„Î·

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
exports.create = async (req,res) => {
  const username = req.body.username
  const name = req.body.name
  const password = req.body.password
  const email = req.body.email
  const roles = req.body.roles

  // na prostethei elegxos me if

  try {
    const newUser = new User({
      username: username,
      name: name,
      password: password,
      email: email,
      roles: roles
    })
    await newUser.save()
    res.status(201).json(newUser)
  } catch(error) {
    res.status(400).json({error: error.message})
  }
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.routes.js
```javascript
router.get ('/', userController.findAll)
router.post('/', userController.create)
```

## Î”Î¿ÎºÎ¹Î¼Î® Î¼Îµ Postman

- GET ÏƒÏ„Î¿ `localhost:3000/api/users`: Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ `{ "status": true, "data": [] }`
- POST ÏƒÏ„Î¿ `localhost:3000/api/users` Î¼Îµ body:
  ```json
  {
      "username":"alkisax",
      "name":"alkis",
      "roles":["admin"],
      "email": "alkisax@gmail.com",
      "password":"123"
  }
  ```
  Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ:
  ```json
  {
      "username": "alkisax",
      "name": "alkis",
      "roles": [
          "admin"
      ],
      "email": "alkisax@gmail.com",
      "password": "123",
      "_id": "67fc141a3af9a6a44597fc51",
      "createdAt": "2025-04-13T19:44:26.990Z",
      "updatedAt": "2025-04-13T19:44:26.990Z",
      "__v": 0
  }
  ```

## ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® Ï„Î¿Ï… Password ÏƒÎµ hashedPassword

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… users.models.js
```javascript
// password:{
//   type: String,
//   required: [true, 'password is required'],
// },
hashedPassword: {
  type: String,
  required: [true, 'password is required'],
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
const bcrypt = require('bcrypt')

// Î£Ï„Î¿ exports.create
const SaltOrRounds = 10
const hashedPassword = await bcrypt.hash(password, SaltOrRounds)

// ÎšÎ±Î¹ Ï„Î¿ newUser Î³Î¯Î½ÎµÏ„Î±Î¹:
const newUser = new User({
  username: username,
  name: name,
  hashedPassword: hashedPassword,
  email: email,
  roles: roles
})
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Login Endpoint

### services/auth.service.js
```javascript
const jwt = require('jsonwebtoken')
const bcrypt = require('bcrypt')

generateAccessToken = (user) => {
  const payload = {
    username: user.username,
    email: user.email,
    roles: user.roles,
    id: user._id
  }

  const secret = process.env.SECRET
  const options = {
    expiresIn: '1h'
  }
  const token = jwt.sign(payload, secret, options)
  return token
}

const verifyPassword = async (password, hashedPassword) => {
  return await bcrypt.compare(password, hashedPassword)
}

const verifyAccessToken = (token) => {
  const secret = process.env.SECRET
  try {
    const payload = jwt.verify(token, secret)
    return { 
      verified: true, data: payload
    }
  } catch (error) {
    return { 
      verified: false, data: error.message
    }
  }
} 

module.exports = {
  generateAccessToken,
  verifyPassword,
  verifyAccessToken
}
```

### auth.controller.js
```javascript
const bcrypt = require('bcrypt')
const User = require('../models/users.models')

exports.findAll = async (req,res) => {
 const results = await User.find()
 res.json({
  status: true,
  data: results
})
}

exports.create = async (req,res) => {
  let data = req.body

  const username = req.body.username
  const name = req.body.name
  const password = req.body.password
  const email = req.body.email
  const roles = req.body.roles

  const SaltOrRounds = 10
  const hashedPassword = await bcrypt.hash(password, SaltOrRounds)

  // na prostethei elegxos me if

  try {
    const newUser = new User({
      username: username,
      name: name,
      hashedPassword: hashedPassword,
      email: email,
      roles: roles
    })
    await newUser.save()
    res.status(201).json(newUser)
  } catch(error) {
    res.status(400).json({error: error.message})
  }
}
```

### auth.routes.js
```javascript
const express = require('express')
const router = express.Router()
const authController = require('../controllers/auth.controller')

router.post('/', authController.login)

module.exports = router
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· server.js
```javascript
const authRoutes = require('./routes/auth.routes.js')

app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
```

## Î”Î¿ÎºÎ¹Î¼Î® Login Î¼Îµ Postman

- POST ÏƒÏ„Î¿ `localhost:3000/api/login` Î¼Îµ body:
  ```json
  {
      "username": "alkisax",
      "password": "123"
  }
  ```
  Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ:
  ```json
  {
    "status": true,
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFsa2lzYXgiLCJlbWFpbCI6ImFsa2lzYXhAZ21haWwuY29tIiwicm9sZXMiOlsiYWRtaW4iXSwiaWQiOiI2N2ZjYTljODI1YWM4ZTBhMTM0N2JjZDQiLCJpYXQiOjE3NDQ2MTIzMTksImV4cCI6MTc0NDYxNTkxOX0.BCsm61ls3meU3ZOxgeQrZ3fNFTm7_5jru65qfrOBKyg",
        "user": {
            "username": "alkisax",
            "email": "alkisax@gmail.com",
            "roles": [
                "admin"
            ],
            "id": "67fca9c825ac8e0a1347bcd4"
        }
     }
  }
  ```

## Î•Ï€Î±Î»Î®Î¸ÎµÏ…ÏƒÎ· Token Î³Î¹Î± Route Protection

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ auth.service.js
```javascript
const getTokenFrom = (req) => {
  const authorization = req.get('authorization')
  if (authorization && authorization.toLowerCase().startsWith('bearer ')) {
    return authorization.replace('Bearer ', '')
  }
  return null
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
exports.findAll = async (req,res) => {
  const results = await User.find()

  const token = authService.getTokenFrom(req)
  const verificationResult = authService.verifyAccessToken(token)
  if (!verificationResult.verified) {
    return res.status(401).json({
      status: false,
      error: verificationResult.data
    })
  }
  if (!verificationResult.data.roles.includes('admin')) {
    return res.status(403).json({
      status: false,
      error: 'Forbidden'
    })
  }

  res.json({
    status: true,
    data: results
  })
}
```

## Î”Î¿ÎºÎ¹Î¼Î® Î¼Îµ Postman ÎºÎ±Î¹ Token
GET ÏƒÏ„Î¿ `localhost:3000/api/users` Î¼Îµ Header:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

Î›Î±Î¼Î²Î¬Î½Î¿Ï…Î¼Îµ Ï„Î· Î»Î¯ÏƒÏ„Î± Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½.

## Google Login

### Î¡ÏÎ¸Î¼Î¹ÏƒÎ· ÏƒÏ„Î¿ Google Cloud Platform
1. https://cloud.google.com/gcp -> console -> select project -> new project
2. API and services -> credentials -> create credentials -> oauth client ID
3. Configure consent screen -> create oauth client -> web app
4. Auth redirect uri -> http://localhost:3000/api/auth/google/callback
5. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± clients

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ .env
```
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...
REDIRECT_URI=http://localhost:3000/api/auth/google/callback
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… server.js
```javascript
app.use('/api/auth', authRoutes)
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… auth.routes.js
```javascript
router.get('/google/callback', authController.googleLogin)
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… auth.controller.js
```javascript
exports.googleLogin = async(req, res) => {
  const code = req.query.code
  if (!code) {
    res.status(400).json({status: false, data: "auth code is missing"})
  } else {
    let { user } = await authService.googleAuth(code)
    return res.redirect('https://www.wikipedia.org') //Ï€ÏÎ¿ÏƒÎ¿ÏÎ¹Î½Î± Î³Î¹Î± Î»Î¿Î³Î¿Ï…Ï‚ Ï„ÎµÏƒÏ„Î¹Î½Î³Îº
  }
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… auth.service.js
```javascript
const { OAuth2Client } = require('google-auth-library')
[...]
const googleAuth = async (code) => {
  console.log("Google login", code);
  const CLIENT_ID = process.env.GOOGLE_CLIENT_ID;
  const CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET;
  const REDIRECT_URI = process.env.REDIRECT_URI;

  const oauth2Client = new OAuth2Client(CLIENT_ID, CLIENT_SECRET, REDIRECT_URI);

  try {
    // Exchange code for tokens
    const { tokens } = await oauth2Client.getToken(code)
    console.log("Step 1", tokens)
    oauth2Client.setCredentials(tokens)

    const ticket = await oauth2Client.verifyIdToken({
      idToken: tokens.id_token,
      audience: CLIENT_ID
    });

    console.log("Step 2")

    const userInfo = await ticket.getPayload();
    console.log("Google User", userInfo);
    return {user: userInfo, tokens}
  } catch (error) {
    console.log("Error in google authentication", error);
    return { error: "Failed to authenticate with google"}
  }
}

module.exports = {
  generateAccessToken,
  verifyPassword,
  verifyAccessToken,
  getTokenFrom,
  googleAuth
}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ‡Î¿Î»Î¯Î¿Ï… Î¼Îµ Ï„Î¿ Link ÏƒÏ„Î± routes
```javascript
// https://accounts.google.com/o/oauth2/auth?client_id={apo_to_google}&redirect_uri={apo_to_google}&response_type={apo_to_auth.service}&scope=email%20profile&access_type=offline
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Logger

### logger/logger.js
```javascript
const { createLogger, format, transports } = require('winston');
require('winston-mongodb');

const logger = createLogger({
  format: format.combine(
    format.timestamp(),
    format.simple()
  ),
  transports: [
    new transports.Console(), // show logs in terminal

    new transports.File({      // save to file
      filename: 'logs/all.log'
    }),

    new transports.MongoDB({   // save to MongoDB
      db: process.env.MONGODB_URI || 'mongodb://localhost:27017/logsdb',
      collection: 'logs',
      level: 'info',  // logs info and above (warn, error)
    })
  ]
});

module.exports = logger;
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… server.js
```javascript
const url = require('url');
const logger = require('./logger/logger.js');
[...]
app.use((req, res, next) => {
  const pathname = url.parse(req.originalUrl).pathname;
  logger.info(`${req.method} ${pathname}`);
  next();
});
```

### Î Î±ÏÎ±Î´ÎµÎ¯Î³Î¼Î±Ï„Î± Logging ÏƒÏ„Î¿Ï…Ï‚ Controllers
```javascript
logger.error(`Login error: ${error.message}`);
logger.warn(`Failed login attempt with username: ${req.body.username}`);
logger.info(`User ${user.username} logged in successfully`);
if (user && user.email) {
  logger.info(`User ${user.email} logged in via Google`);
} else {
  logger.info('Google login succeeded, but user info is incomplete');
}
```

## Swagger Documentation

### Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
```bash
npm install swagger-jsdoc
```

### swagger.js
```javascript
// Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î·Ï‚ Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ·Ï‚ Ï€Î¿Ï… Î¼ÎµÏ„Î±Ï„ÏÎ­Ï€ÎµÎ¹ Mongoose models ÏƒÎµ Swagger schemas
const m2s = require('mongoose-to-swagger');
// Î¦ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Î¿Ï… Mongoose Î¼Î¿Î½Ï„Î­Î»Î¿Ï… Î³Î¹Î± Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·
const User = require('./models/users.models');
// Î— Î²Î±ÏƒÎ¹ÎºÎ® Î²Î¹Î²Î»Î¹Î¿Î¸Î®ÎºÎ· Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Swagger spec Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ configuration ÎºÎ±Î¹ Ï„Î± JSDoc ÏƒÏ‡ÏŒÎ»Î¹Î±
const swaggerJsdoc = require('swagger-jsdoc');
// ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Î³Î¹Î± Ï„Î· Swagger Ï„ÎµÎºÎ¼Î·ÏÎ¯Ï‰ÏƒÎ·
const options = {
  definition: {
    // ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Î·Ï‚ Î­ÎºÎ´Î¿ÏƒÎ·Ï‚ OpenAPI (Swagger) Ï€Î¿Ï… Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯
    openapi: "3.1.0",
    // Î Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚ Î³Î¹Î± Ï„Î¿ API Î¼Î±Ï‚ (Ï„Î¯Ï„Î»Î¿Ï‚, Ï€ÎµÏÎ¹Î³ÏÎ±Ï†Î®, Î­ÎºÎ´Î¿ÏƒÎ·)
    info: {
      version: "1.0.0",
      title: "User and Auth API",
      description: "ÎœÎ¹Î± ÎµÏ†Î±ÏÎ¼Î¿Î³Î® Î³Î¹Î± Ï„Î· Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½ ÎºÎ±Î¹ Ï„Î·Î½ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ· Î¼Îµ JWT ÎºÎ±Î¹ Google login",
    },
    // ÎŸÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï„Ï‰Î½ components, Î´Î·Î»Î±Î´Î® Ï„Ï‰Î½ reusable ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½ Ï„Î¿Ï… Swagger ÏŒÏ€Ï‰Ï‚ schemas ÎºÎ±Î¹ security definitions
    components: {
      schemas: {
        // Î•Î´Ï Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¿ÏÎ¼Îµ Ï„Î¿ schema Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î· Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¿ Mongoose Î¼Î¿Î½Ï„Î­Î»Î¿
        User: m2s(User)
      },
      // Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Ï„Î¿Ï… Î¼Î·Ï‡Î±Î½Î¹ÏƒÎ¼Î¿Ï Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ Î¼Îµ Bearer token (JWT)
      securitySchemes: {
        bearerAuth: {
          type: "http",          // Î•Î¯Î´Î¿Ï‚ Î±Ï…Î¸ÎµÎ½Ï„Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚
          scheme: "bearer",      // Î§ÏÎ®ÏƒÎ· Bearer token
          bearerFormat: "JWT"    // Î ÏÎ¿ÏƒÎ´Î¹Î¿ÏÎ¯Î¶Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ ÎµÎ¯Î½Î±Î¹ JWT
        }
      }
    },
    // Î•Ï†Î±ÏÎ¼Î¿Î³Î® Ï„Î·Ï‚ Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±Ï‚ (bearerAuth) ÏƒÎµ ÏŒÎ»Î± Ï„Î± endpoints, ÎµÎºÏ„ÏŒÏ‚ Î±Î½ Î¿ÏÎ¹ÏƒÏ„ÎµÎ¯ Î±Î»Î»Î¹ÏÏ‚ ÏƒÎµ ÎºÎ¬Ï€Î¿Î¹Î¿ ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î¿
    security: [
      {
        bearerAuth: []  // Î”ÎµÎ½ Î±Ï€Î±Î¹Ï„Î¿ÏÎ½Ï„Î±Î¹ scopes
      }
    ]
  },
  // ğŸ”½ Î¤Î¿ Ï€Î¹Î¿ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÏŒ ÏƒÎ·Î¼ÎµÎ¯Î¿: ÎºÎ±Î¸Î¿ÏÎ¯Î¶Î¿Ï…Î¼Îµ Ï€Î¿Ï… Î²ÏÎ¯ÏƒÎºÎ¿Î½Ï„Î±Î¹ Ï„Î± Î±ÏÏ‡ÎµÎ¯Î± Ï€Î¿Ï… Ï€ÎµÏÎ¹Î­Ï‡Î¿Ï…Î½ Swagger ÏƒÏ‡ÏŒÎ»Î¹Î± (JSDoc)
  // Î•Î´Ï Î²Î»Î­Ï€ÎµÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï†Î±ÎºÎ­Î»Î¿Ï…Ï‚ routes ÎºÎ±Î¹ controllers Î³Î¹Î± Swagger annotations
  apis: ['./routes/*.js', './controllers/*.js'], // ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï€ÏÎ¿ÏƒÎ¸Î­ÏƒÎµÎ¹Ï‚ ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ Î¼Î¿Î½Î¿Ï€Î¬Ï„Î¹Î± Î±Î½ Ï‡ÏÎµÎ¹Î±ÏƒÏ„ÎµÎ¯
};
// Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… Swagger specification Î¼Îµ Î²Î¬ÏƒÎ· Ï„Î¹Ï‚ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ ÏÏ…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚
const swaggerSpec = swaggerJsdoc(options);
// Î•Î¾Î±Î³Ï‰Î³Î® Ï„Î¿Ï… Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… ÏÏƒÏ„Îµ Î½Î± Ï„Î¿ Ï†Î¿ÏÏ„ÏÏƒÎ¿Ï…Î¼Îµ Î±Ï€ÏŒ Ï„Î¿ server.js
module.exports = swaggerSpec;
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… server.js
```javascript
const swaggerSpec = require('./swagger.js');
const swaggerUI = require('swagger-ui-express')
[...]
app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec));
```

### Swagger Annotations ÏƒÏ„Î¿Ï…Ï‚ Controllers
```javascript
/**
 * @swagger
 * /api/users:
 *   get:
 *     summary: Get all users
 *     description: Retrieve all users from the database (admin access required).
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: List of users
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 status:
 *                   type: boolean
 *                 data:
 *                   type: array
 *                   items:
 *                     type: object
 *                     properties:
 *                       username:
 *                         type: string
 *                       email:
 *                         type: string
 *                       roles:
 *                         type: array
 *                         items:
 *                           type: string
 *                       id:
 *                         type: string
 *       401:
 *         description: Unauthorized access (invalid or missing token)
 *       403:
 *         description: Forbidden access (non-admin role)
 *       500:
 *         description: Internal server error
 *     tags:
 *       - Users
 */
exports.findAll = async (req,res) => {
```

ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Swagger ÏƒÏ„Î¿ http://localhost:3000/api-docs/#/

## Middleware Î³Î¹Î± Role-Based Access Control

### middleware/verification.middleware.js
```javascript
// middleware/verification.middleware.js

const authService = require('../services/auth.service');
const logger = require('../logger/logger');

/**
 * Middleware to verify JWT token.
 * Attaches decoded user data to `req.user` if valid.
 */
const verifyToken = (req, res, next) => {
  const token = authService.getTokenFrom(req);
  const verificationResult = authService.verifyAccessToken(token);

  if (!verificationResult.verified) {
    logger.warn(`Unauthorized access attempt with token: ${token}`);
    return res.status(401).json({
      status: false,
      error: verificationResult.data
    });
  }

  req.user = verificationResult.data;
  next();
};

/**
 * Middleware to check if user has required role.
 * Call after verifyToken middleware.
 */
const checkRole = (requiredRole) => {
  return (req, res, next) => {
    const user = req.user;

    if (!user || !user.roles.includes(requiredRole)) {
      logger.warn(`Forbidden access by user: ${user?.username || 'unknown'}`);
      return res.status(403).json({
        status: false,
        error: 'Forbidden'
      });
    }

    next();
  };
};

module.exports = {
  verifyToken,
  checkRole
};
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.controller.js
```javascript
exports.findAll = async (req,res) => {
  const results = await User.find()
  res.json({
    status: true,
    data: results
  })
}
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… user.routes.js
```javascript
const { verifyToken, checkRole } = require('../middleware/verification.middleware');
router.get ('/', verifyToken, checkRole('admin'), userController.findAll)
```

## Î•Ï€ÏŒÎ¼ÎµÎ½Î± Î’Î®Î¼Î±Ï„Î±

1. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Jest/Supertest unit ÎºÎ±Î¹ integration tests Î³Î¹Î± `/api/login` ÎºÎ±Î¹ `/api/users`
2. Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± minimal admin panel Î³Î¹Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· Ï‡ÏÎ·ÏƒÏ„ÏÎ½ (CRUD frontend Î³Î¹Î± `/api/users`)
3. Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Î¿Ï… token ÏƒÏ„Î·Î½ Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î® Î¼Î½Î®Î¼Î· Ï„Î¿Ï… browser
4. Î£ÏÎ½Î´ÎµÏƒÎ· frontend Î¼Îµ server
5. ÎœÎµ router-dom ÎµÏ€Î¹Ï€Î»Î­Î¿Î½ ÏƒÎµÎ»Î¯Î´Î± Î³Î¹Î± users

# ÎŸÎ´Î·Î³ÏŒÏ‚ Î‘Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚ Full Stack Î¼Îµ Node.js ÎºÎ±Î¹ React

## Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Server Î±Ï€ÏŒ App

### Î‘ÏÏ‡Î¹ÎºÎ® ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· server.js

```javascript
require('dotenv').config()
require('express-async-errors')
const url = require('url');
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const authRoutes = require('./routes/auth.routes.js')
const { log } = require('winston')
const logger = require('./logger/logger.js');
const swaggerSpec = require('./swagger.js');
const swaggerUI = require('swagger-ui-express')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ‰
app.use(express.json());
// Set up Swagger UI endpoint
app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec));

mongoose.set('strictQuery', false)
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    // console.log('connected to MongoDB', process.env.MONGODB_URI)
    console.log('connected to MongoDB')
  })
  .catch((error) => {
    console.log('error connecting to MongoDB:', error.message)
  })

app.use((req, res, next) => {
  const pathname = url.parse(req.originalUrl).pathname;
  logger.info(${req.method} ${pathname});
  next();
});

app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
app.use('/api/auth', authRoutes)

// Start the server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(Server running on port ${PORT});
});

module.exports = app
```

### Î”Î¹Î±Ï‡Ï‰ÏÎ¹ÏƒÎ¼ÏŒÏ‚ ÏƒÎµ Î”ÏÎ¿ Î‘ÏÏ‡ÎµÎ¯Î±

#### ÎÎ­Î¿ server.js
```javascript
require('dotenv').config();
const mongoose = require('mongoose');
const app = require('./app'); // import the Express app from app.js

mongoose.set('strictQuery', false);
mongoose.connect(process.env.MONGODB_URI)
  .then(() => {
    console.log('connected to MongoDB');
    const PORT = process.env.PORT || 3000;
    app.listen(PORT, () => {
      console.log(`Server running on port ${PORT}`);
    });
  })
  .catch((error) => {
    console.error('error connecting to MongoDB:', error.message);
  });
```

#### ÎÎ­Î¿ app.js
```javascript
require('dotenv').config()
require('express-async-errors')
const url = require('url');
const express = require('express')
const cors = require('cors')
const mongoose = require('mongoose')
const userRoutes = require('./routes/user.routes.js')
const authRoutes = require('./routes/auth.routes.js')
const { log } = require('winston')
const logger = require('./logger/logger.js');
const swaggerSpec = require('./swagger.js');
const swaggerUI = require('swagger-ui-express')

const app = express()
app.use(cors())
app.use(express.static('dist')) // Î½Î± Ï„Î¿ Î´Î¿ÎºÎ¹Î¼Î±ÏƒÏ‰
app.use(express.json());
app.use('/api-docs', swaggerUI.serve, swaggerUI.setup(swaggerSpec)); // Set up Swagger UI endpoint
app.use((req, res, next) => {
  const pathname = url.parse(req.originalUrl).pathname;
  logger.info(`${req.method} ${pathname}`);
  next();
});

app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
app.use('/api/auth', authRoutes)

module.exports = app
```

## Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Jest/Supertest Î³Î¹Î± Unit ÎºÎ±Î¹ Integration Tests

### Î•Î³ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· Î±Ï€Î±ÏÎ±Î¯Ï„Î·Ï„Ï‰Î½ Ï€Î±ÎºÎ­Ï„Ï‰Î½
```bash
npm install --save-dev jest 
npm install --save-dev supertest
npm install --save-dev cross-env
npm install --save-dev dotenv
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏÏ…Î¸Î¼Î¯ÏƒÎµÏ‰Î½ Jest ÏƒÏ„Î¿ package.json
```json
"jest": {
  "collectCoverage":true,
  "coveragePathIgnorePatterns": [
    "/node_modules/",
    "/logs"
  ],
  "setupFiles": [
    "dotenv/config"
  ]
},
"scripts": {
  "test": "cross-env NODE_ENV=test jest --testTimeout=50000"
}
```

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± .env Î±ÏÏ‡ÎµÎ¯Î¿Ï… Î³Î¹Î± test
```
MONGODB_TEST_URI = mongodb+srv://alkisax:{password}@cluster0.8ioq6.mongodb.net/loginAPP_TEST?retryWrites=true&w=majority&appName=Cluster0
```

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Test Î³Î¹Î± Login (__test__/login.test.js)
```javascript
const mongoose = require("mongoose");
const request = require("supertest");
const bcrypt = require("bcrypt");
const app = require("../app");

const User = require("../models/users.models");
const authService = require("../services/auth.service");

const TEST_USER = {
  username: "testuser",
  name: "Test User",
  email: "testuser@example.com",
  password: "testpassword",
  roles: ["admin"]
};

beforeEach(async () => {
  await mongoose.connect(process.env.MONGODB_TEST_URI);
  await User.deleteMany({});

  const saltRounds = 10;
  const hashedPassword = await bcrypt.hash(TEST_USER.password, saltRounds)

  await User.create({
    username: TEST_USER.username,
    name: TEST_USER.name,
    email: TEST_USER.email,
    hashedPassword: hashedPassword,
    roles: TEST_USER.roles
  })
})

afterEach(async () => {
  await mongoose.connection.close();
})

afterAll(async () => {
  await mongoose.disconnect();
})

describe("POST /api/login", () => {
  it("should return a valid token and user data when credentials are correct", async () => {
    const res = await request(app)
      .post("/api/login")
      .send({
        username: TEST_USER.username,
        password: TEST_USER.password
      });

    expect(res.statusCode).toBe(200);
    expect(res.body.status).toBe(true);
    expect(res.body.data.token).toBeDefined();
    expect(res.body.data.user).toMatchObject({
      username: TEST_USER.username,
      email: TEST_USER.email,
      roles: TEST_USER.roles
    });
  });
});
```

## ÎœÎµÏ„Î±Ï„ÏÎ¿Ï€Î® ÏƒÎµ DTO DAO Pattern

### Data Access Object (DAO)
#### daos/user.dao.js
```javascript
const User = require('../models/users.models');

const findAllUsers = async () => {
  return await User.find();
};

const findUserByUsername = async (username) => {
  return await User.findOne({ username });
};

const findUserByEmail = async (email) => {
  return await User.findOne({ email });
};

const createUser = async (userData) => {
  const user = new User(userData);
  return await user.save();
};

module.exports = {
  findAllUsers,
  findUserByUsername,
  findUserByEmail,
  createUser
};
```

### Î‘Î»Î»Î±Î³Î­Ï‚ ÏƒÏ„Î¿ user.controller.js
```javascript
const userDAO = require('../daos/user.dao')

exports.findAll = async (req, res) => {
  // transfer to dao
  // res.json({
  //   status: true,
  //   data: results
  // })
  const users = await userDAO.findAllUsers();
  res.json({ status: true, data: users });
}

exports.create = async (req, res) => {
  // ...
  // const newUser = new User({
  //   username: username,
  //   name: name,
  //   hashedPassword: hashedPassword,
  //   email: email,
  //   roles: roles
  // })
  // await newUser.save()
  const newUser = await userDAO.createUser({
    username,
    name,
    email,
    roles,
    hashedPassword
  });
  // ...
}
```

### Î‘Î»Î»Î±Î³Î­Ï‚ ÏƒÏ„Î¿ auth.controller.js
```javascript
const userDAO = require('../daos/user.dao')

// const user = await User.findOne({username: req.body.username})
const user = await userDAO.findUserByUsername(req.body.username);
```

### Data Transfer Object (DTO) - Î—Î¼Î¹Ï„ÎµÎ»Î­Ï‚
#### dtos/user.dto.js
```javascript
const toUserDTO = (user) => {
  return {
    id: user._id,
    username: user.username,
    email: user.email,
    name: user.name,
    roles: user.roles,
    createdAt: user.createdAt,
    updatedAt: user.updatedAt
  };
};

module.exports = {
  toUserDTO
};
```

## Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Tests

### Î’ÎµÎ»Ï„Î¹ÏÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ auth.controller.js Î³Î¹Î± ÎˆÎ»ÎµÎ³Ï‡Î¿ ÎšÎµÎ½ÏÎ½ Î ÎµÎ´Î¯Ï‰Î½
```javascript
exports.login = async (req, res) => {
  try {
    const username = req.body.username
    const password = req.body.password

    if (!username) {
      logger.warn("Login attempt missing username");
      return res.status(400).json({
        status: false,
        message: "Username is required"
      });
    }
    
    if (!password) {
      logger.warn("Login attempt missing password");
      return res.status(400).json({
        status: false,
        message: "Password is required"
      });
    }
    // ...
```

### Î ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎ± Test Cases Î³Î¹Î± Login
```javascript
it("should fail with wrong password", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      username: TEST_USER.username,
      password: "wrongpassword"
    });

  expect(res.statusCode).toBe(401);
  expect(res.body.status).toBe(false);
  expect(res.body.message).toBe("Invalid username or password");
});

it("should fail with non-existent username", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      username: "notARealUser",
      password: "anyPassword"
    });

  expect(res.statusCode).toBe(401);
  expect(res.body.status).toBe(false);
  expect(res.body.message).toBe("Invalid username or password");
});

it("should fail when username is missing", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      password: TEST_USER.password
    });

  expect(res.statusCode).toBe(400); // you may need to validate and return 400 for bad input
  expect(res.body.status).toBe(false);
});

it("should fail when password is missing", async () => {
  const res = await request(app)
    .post("/api/login")
    .send({
      username: TEST_USER.username
    });

  expect(res.statusCode).toBe(400); // same here
  expect(res.body.status).toBe(false);
});
```

## Î£ÏÎ½Î´ÎµÏƒÎ· Frontend Î¼Îµ Server

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î”Î¿ÎºÎ¹Î¼Î±ÏƒÏ„Î¹ÎºÎ¿Ï API Endpoint Î³Î¹Î± Message
#### message.controller.js
```javascript
/**
 * @swagger
 * /api/message:
 *   get:
 *     summary: Get a welcome message from the server
 *     description: Returns a simple "Hello from the server" message
 *     responses:
 *       200:
 *         description: A welcome message
 *       500:
 *         description: Internal server error
 *     tags:
 *       - Message
 */
exports.message = (req, res) => {
  try {
    res.status(200).json({
      status: true,
      message: "Hello from the server!"
    });
  } catch (error) {
    res.status(500).json({
      status: false,
      error: "Internal server error"
    });
  }
}
```

#### message.routes.js
```javascript
const express = require('express')
const router = express.Router()
const messageController = require('../controllers/message.controller')

router.get ('/', messageController.message)

module.exports = router
```

#### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ app.js
```javascript
const messageRoutes = require('./routes/message.routes.js')
app.use('/api/message', messageRoutes)
```

### Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· API ÏƒÏ„Î¿ React App
#### app.jsx
```javascript
const [message, setMessage] = useState('')

useEffect(() => {
  axios.get('http://localhost:3000/api/message')
    .then(res => setMessage(res.data.message))
    .catch(err => console.error(err));
}, [])

return (
  <div>
    <h1>{message}</h1>
    {/* ... */}
  </div>
)
```

### Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Login Form ÎºÎ±Î¹ Frontend Authentication
#### app.jsx
```javascript
const url = 'http://localhost:3000/api'

const [username, setUsername] = useState('')
const [password, setPassword] = useState('')
const [userIsAdmin, setUserIsAdmin] = useState(false)

const handleLogin = async (event) => {
  event.preventDefault()
  console.log("Submitting login...")

  try {
    const response = await axios.post(`${url}/login`, {
      "username": username,
      "password": password
    })
    console.log("Login successful", response.data)
    const { token, user } = response.data.data
    setUser(user)
    localStorage.setItem("token", token)
    localStorage.setItem("roles", JSON.stringify(user.roles))

    const isAdmin = user.roles.includes("admin")
    setUserIsAdmin(isAdmin)
    console.log("Is admin?", isAdmin)

  } catch (error) {
    console.log(error)     
  }
}

// Î£Ï„Î¿ return
{user === null && 
  <LoginForm 
    username={username}
    password={password}
    setUsername={setUsername}
    setPassword={setPassword}
    handleLogin={handleLogin}
  />}
```

### Î¥Î»Î¿Ï€Î¿Î¯Î·ÏƒÎ· Logout
#### userLogedInView.jsx
```javascript
const UserLogedInView = ({ handleLogout }) => {
  return (
    <>
      <h1>Welcome user</h1>
      <button onClick={handleLogout}>log out</button>
    </>
  )
}
export default UserLogedInView
```

#### app.jsx
```javascript
const handleLogout = async () => {
  localStorage.removeItem("token")
  setUser(null)
  setUserIsAdmin(false)
  console.log("Logged out successfully")
}

// Î£Ï„Î¿ return
{user !==  null && 
  <UserLogedInView 
    handleLogout={handleLogout}
  />}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Admin Button ÏƒÏ„Î¿ UserLoggedInView
```javascript
// userLogedInView.jsx
{userIsAdmin &&
  <button onClick={handleAdminBtn}>admin panel</button> 
}

// app.jsx
<UserLogedInView 
  handleLogout={handleLogout}
  userIsAdmin={userIsAdmin}
  handleAdminBtn={handleAdminBtn}
/>
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Admin Panel

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î’Î±ÏƒÎ¹ÎºÎ¿Ï Admin Panel Component
#### frontend/src/components/AdminPanel.jsx
```javascript
const AdminPanel = () => {
  return (
    <div>
      <h2>Admin Panel</h2>
      <p>Only admins can see this.</p>
    </div>
  )
}

export default AdminPanel
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· React Router
#### main.jsx
```javascript
import { BrowserRouter as Router } from 'react-router-dom'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <Router>
      <App />
    </Router>
  </StrictMode>,
)
```

#### app.jsx
```javascript
import {
  BrowserRouter as Router,
  Routes, Route, Link, useNavigate
} from 'react-router-dom'

import AdminPanel from './components/AdminPanel'

const navigate = useNavigate()

const handleAdminBtn = () => {
  navigate("/admin")   
}

return (
  <div>
    <h6>{message}</h6>
    <h1>Login APP</h1>

    {/* Routes here handle sub-pages like /admin */}
    <Routes>
      <Route path="/" element={
        <>
          {user === null && 
          <LoginForm 
            username={username}
            password={password}
            setUsername={setUsername}
            setPassword={setPassword}
            handleLogin={handleLogin}
          />}
          {user !==  null && 
          <UserLogedInView 
            handleLogout={handleLogout}
            userIsAdmin={userIsAdmin}
            handleAdminBtn={handleAdminBtn}
          />}
        </>
      } /> 
      <Route path="/admin" element={<AdminPanel />} />        
    </Routes>
  </div>
)
```

### Î ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚ ÏƒÏ„Î¿ Admin Panel ÎœÏŒÎ½Î¿ Î³Î¹Î± Admins
#### src/services/ProtectedRoute.js
```javascript
import { Navigate } from 'react-router-dom';

const ProtectedRoute = ({ user, children, requiredRole }) => {
  if (!user) {
    return <Navigate to="/" />;
  }

  if (requiredRole && !user.roles.includes(requiredRole)) {
    return <Navigate to="/" />;
  }

  return children;
};

export default ProtectedRoute;
```

#### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÏƒÏ„Î¿ App.jsx Î³Î¹Î± Ï„Î¿ Admin Route
```javascript
<Route path="/admin" element={
  <>
    <ProtectedRoute user={user} requiredRole="admin"></ProtectedRoute>
    <AdminPanel/>
  </>
} />
```

## Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î§ÏÎ®ÏƒÏ„Î· Î±Ï€ÏŒ Ï„Î¿ Admin Panel

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· URL ÏƒÏ„Î¿ AdminPanel
```javascript
// App.jsx
<Route path="/admin" element={
  <>
    <ProtectedRoute user={user} requiredRole="admin"></ProtectedRoute>
    <AdminPanel
      url={url}
    />
  </>
} />
```

### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… AdminPanel.jsx
```javascript
import NewUserForm from './NewUserForm'
const AdminPanel = ({url}) => {
  // ...
  return (
    <div>
      {/* ... */}
      <button onClick={() => setViewForm(!viewForm)}>create user form</button>
      {viewForm && <NewUserForm url={url} />}
      {/* ... */}
    </div>
  )
}
```

### Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± NewUserForm.jsx
```javascript
import {useState} from 'react'
import axios from 'axios'

const NewUserForm = ({ url }) => {
  const [username, setUsername] = useState('')
  const [name, setName] = useState('')
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [roles, setRoles] = useState(['user'])

  const handleSubmitUser = async (event) => {
    event.preventDefault()
    
    try {
      const newUser = {
        "username": username,
        "name": name,
        "email": email,
        "password": password,
        "roles": roles
      }

      const response = await axios.post(`${url}/users`, newUser)

      console.log('âœ… User created:', response.data)
      alert('User created successfully!')

      // Clear the form if needed
      setUsername('')
      setName('')
      setEmail('')
      setPassword('')
      setRoles(['user'])

    } catch (error) {
      console.error('Error creating user:', error)
    }
  }

  return (
    <>
      <form onSubmit={handleSubmitUser}>
        <div>
          username
          <input type="text"
          value={username}
          name="username"
          onChange={({target}) => setUsername(target.value)}
          autoComplete="username"
          />
        </div>
        <div>
          name
          <input type="text"
          value={name}
          name="name"
          onChange={({target}) => setName(target.value)}
          autoComplete="name"
          />
        </div>
        <div>
          email
          <input type="email"
          value={email}
          name="email"
          onChange={({target}) => setEmail(target.value)}
          autoComplete="email"
          />
        </div>
        <div>
          <label>
            <input
              type="checkbox"
              value="admin"
              checked={roles.includes('admin')}
              onChange={({ target }) => {
                if (target.checked) {
                  setRoles([...roles, 'admin'])
                } else {
                  setRoles(roles.filter(r => r !== 'admin'))
                }
              }}
            />
            Admin
          </label>
        </div>      
        <div>
          password
          <input type="text"
          value={password}
          name="password"
          onChange={({target}) => setPassword(target.value)}
          autoComplete="password"
          />
        </div>
        <button type="submit">submit</button>
      </form>
    </>
  )
}
export default NewUserForm
```

## Remember Login
### Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚ Î£ÏÎ½Î´ÎµÏƒÎ·Ï‚ Î¼Îµ Local Storage
```javascript
// App.jsx
useEffect(() => {
  const token = localStorage.getItem("token")
  const roles = JSON.parse(localStorage.getItem("roles"))
  if (token && roles) {
    const userFromStorage = { token, roles }
    setUser(userFromStorage) 
    setUserIsAdmin(roles.includes("admin")) 
  }
}, [])
```

## UI Improvements
### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Universal Logout Button
```javascript
// App.jsx
<h1>Login APP</h1>
{user && <button onClick={handleLogout}>log out</button>}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Home Button
```javascript
{/* Universal Home Button */}
<Link to="/" className="home-btn">
  <button>Home</button>
</Link>
```

## Î ÏÎ¿Î²Î¿Î»Î® Î§ÏÎ·ÏƒÏ„ÏÎ½ ÏƒÏ„Î¿ Admin Panel
### AdminPanel.jsx - Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³Î¹ÎºÏŒÏ„Î·Ï„Î±Ï‚ Î ÏÎ¿Î²Î¿Î»Î®Ï‚ Î§ÏÎ·ÏƒÏ„ÏÎ½
```javascript
import { useState, useEffect } from "react"
import axios from 'axios'

const AdminPanel = ({ url }) => {
  const [users, setUsers] = useState([]); 
  const [loading, setLoading] = useState(true);
  const [viewForm, setViewForm] = useState(false);

  useEffect(() => {
    const fetchUsers = async () => {
      try {
        const token = localStorage.getItem("token"); 
        const response = await axios.get(`${url}/users`, {
          headers: {
            Authorization: `Bearer ${token}`, 
          },
        });
        setUsers(response.data.data); 
        setLoading(false);
      } catch (error) {
        console.error("Error fetching users:", error);
        setLoading(false); 
      }
    };

    fetchUsers();
  }, [url]);

  return (
    <div>
      <h2>Admin Panel</h2>
      <p>Only admins can see this.</p>
      {loading && <p>Loading...</p>}
      {!loading && users.length === 0 && <p>No users found</p>}
      <ul>
        {!loading && users.length !== 0 && 
          users.map((user) => {
            return (
              <li key={user.id}>
                {user.username} - {user.name} - {user.email} - {user.roles.join(", ")}
              </li>
            )
          })
        } 
      </ul>
      {/* ... */}
    </div>
  )
}
```

## Google Login Integration

### Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Î ÏÎ¿Î²Î»Î·Î¼Î¬Ï„Ï‰Î½ ÏƒÏ„Î¿ Backend
#### Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· Î”Î¹Ï€Î»ÏÎ½ Routes ÏƒÏ„Î¿ app.js
```javascript
app.use('/api/users', userRoutes)
app.use('/api/login', authRoutes)
// app.use('/api/auth', authRoutes) // Î‘Ï†Î±Î¹ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î´Î¹Ï€Î»ÏŒ route
app.use('/api/message', messageRoutes)
```

#### Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· URL ÏƒÏ„Î¿ auth.routes.js
```javascript
// https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=http://localhost:3000/api/login/google/callback&response_type=code&scope=email%20profile&access_type=offline
```

#### Î¡ÏÎ¸Î¼Î¹ÏƒÎ· Google OAuth Origins ÎºÎ±Î¹ Redirects
```
Authorized JavaScript origins
http://localhost:3000
http://localhost:5173

Authorized redirect URIs
http://localhost:3000/api/login/google/callback
http://localhost:5173/
```

#### Î”Î¹ÏŒÏÎ¸Ï‰ÏƒÎ· auth.controller.js Î³Î¹Î± Ï„Î¿ Google Login
```javascript
const jwt = require('jsonwebtoken');

exports.googleLogin = async(req, res) => {
  const code = req.query.code
  if (!code) {
    logger.warn('Auth code is missing during Google login attempt');
    res.status(400).json({status: false, data: "auth code is missing"})
  } 
  const { user, tokens } = await authService.googleAuth(code);

  if (!user || !user.email) {
    logger.warn('Google login failed or incomplete');
    return res.status(401).json({ status: false, data: "Google login failed" });
  }

  // ğŸ” Create token for your app (JWT etc.)
  const dbUser = await User.findOneAndUpdate(
    { email: user.email },
    { $setOnInsert: { email: user.email, name: user.name, roles: ['user'] } },
    { upsert: true, new: true }
  );

  const payload = { id: dbUser._id, roles: dbUser.roles };
  const token = jwt.sign(payload, process.env.JWT_SECRET, { expiresIn: '1d' });

  return res.redirect(`http://localhost:5173/google-success?token=${token}&email=${dbUser.email}`);
}
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Google Success Component ÏƒÏ„Î¿ Frontend
#### App.jsx
```javascript
import GoogleSuccess from './components/GoogleSuccess'

// ...
<Route path="/google-success" element={
  <GoogleSuccess setUser={setUser} setUserIsAdmin={setUserIsAdmin} />
} />
```

#### components/GoogleSuccess.jsx
```javascript
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

const GoogleSuccess = () => {
  const navigate = useNavigate();

  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const email = params.get('email');

    if (token) {
      // Store the token (adjust storage if you prefer memory/Redux/etc.)
      localStorage.setItem('token', token);
      localStorage.setItem('email', email);

      // Redirect to dashboard or homepage
      navigate('/');
    } else {
      // Maybe show error
      navigate('/login');
    }
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return <div>Logging you in via Google...</div>;
};

export default GoogleSuccess;
```

### Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Google Login Button ÏƒÏ„Î¿ LoginForm
```javascript
// LoginForm.jsx
const googleUrl = 'https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=http://localhost:3000/api/login/google/callback&response_type=code&scope=email%20profile&access_type=offline'

// Î£Ï„Î¿ return
<a href={googleUrl}>
  <button type="button">Login with Google</button>
</a>
```

### Î•Î½ÏƒÏ‰Î¼Î¬Ï„Ï‰ÏƒÎ· Google OAuth Library
```bash
npm install @react-oauth/google
```

#### main.jsx
```javascript
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter as Router } from 'react-router-dom'
import { GoogleOAuthProvider } from '@react-oauth/google'
import App from './App.jsx'

const googleClientId = '37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <Router>
    <GoogleOAuthProvider clientId={googleClientId}> 
      <App />
      </GoogleOAuthProvider>
    </Router>
  </StrictMode>,
)
```

#### App.jsx
```javascript
const handleGoogleLogin = (response) => {
  console.log("Google login response:", response);
  // Send the Google token to your backend for verification
  axios.post(`${url}/login/google/callback`, {
    code: response.code
  }).then(res => {
    // Handle successful Google login (set user, token, etc.)
    console.log("Google login successful", res.data);
  }).catch(err => {
    console.log("Google login error", err);
  });
};

// Î£Ï„Î¿ Route element
<LoginForm 
  username={username}
  password={password}
  setUsername={setUsername}
  setPassword={setPassword}
  handleLogin={handleLogin}
  handleGoogleLogin={handleGoogleLogin}
/>
```

#### LoginForm.jsx
```javascript
import { GoogleLogin } from '@react-oauth/google';

const LoginForm = ({ username, password, setUsername, setPassword, handleLogin, handleGoogleLogin }) => {
  // ...
  return (
    <>
      {/* ... */}
      <GoogleLogin
        onSuccess={handleGoogleLogin}
        onError={(error) => console.log("Google Login Error:", error)}
      />
      {/* ... */}
    </>
  )
}
```

## User Detail Page

### components/UserDetail.jsx
```javascript
import { useParams } from 'react-router-dom';

const UserDetail = () => {
  const { id } = useParams();  // Access the id from the route parameter
  
  return (
    <div>
      <h4>User Detail for ID: {id}</h4>
      {/* Fetch and display user details here */}
    </div>
  );
};

export default UserDetail;
```

### AdminPanel.jsx
```javascript
              <li key={user._id || `${user.username}-${user.email}`}>
                 <Link to={`/users/${user._id}`}>
                  {user.username}
                 </Link>
                 - {user.name} - {user.email} - {user.roles.join(", ")}
              </li>
```
### App.jsx
```javascript
          <Route path="/users" element={<AdminPanel url={url} />} />
          <Route path="/users/:id" element={<UserDetail />} />
```

# ÎµÏ€Î¹Ï€Î»Î­Ï‰Î½ user test Î¼Îµ jest ÏƒÏ„Î¿ backend Ï€Î¿Ï… Î®Ï„Î±Î½ ÎµÎºÏÎµÎ¼Î¼ÏŒÏ„Î·Ï„Î±
## Î±ÏÏ‡Î¹ÎºÎ± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎºÎ¬Î½Ï‰ Î±Î»Î»Î±Î³Î­Ï‚ ÏƒÏ„Î¿ user.controler.js AÏÏ‡Î¹ÎºÎ¬ Î®Ï„Î±Î½:
```javascript
exports.findAll = async (req,res) => {
  const users = await userDAO.findAllUsers();
  res.json({ status: true, data: users });
}
```

### Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ Î¿Îº Î±Î»Î»Î± Ï‡ÏÎµÎ¹Î¬Î¶Î¿Î¼Î±Î¹ Î½Î± Î±Î»Î»Î¬Î¾ÎµÎ¹ Î³Î¹Î± Î½Î± ÎºÎ±Î½Ï‰ Ï„ÎµÏƒÏ„ Î³Î¹Î± Î±Ï€Î¿Ï„Ï…Ï‡Î¯Î±, ÎºÎ±Î¹ Î³Î¯Î½ÎµÏ„Îµ 
```javascript
exports.findAll = async (req,res) => {
  try {

    if (!req.headers.authorization) {
      return res.status(401).json({ status: false, error: 'No token provided' });
    }

    const users = await userDAO.findAllUsers();
    res.status(200).json({ status: true, data: users });
  } catch (error) {
    console.error(error);
    res.status(500).json({ status: false, error: 'Internal server error' });
  }

  // const users = await userDAO.findAllUsers();
  // res.json({ status: true, data: users });
}
```

## Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Ï Ï„Î¿ users.test.js

```javascript
const mongoose = require("mongoose");
const request = require("supertest");
const bcrypt = require("bcrypt");
const app = require("../app");
const jwt = require('jsonwebtoken');
require('dotenv').config()
const User = require("../models/users.models");
const userDAO = require("../daos/user.dao");

const authService = require('../services/auth.service')
const loginRouter = require('../routes/auth.routes')

const TEST_USER_ADMIN = {
  username: "testuser",
  name: "Test User",
  email: "testuser@example.com",
  password: "testpassword",
  roles: ["admin"]
};

let token;

beforeAll(async () => {

  const saltrounds = 10
  const hashedPassword = await bcrypt.hash(TEST_USER_ADMIN.password, saltrounds);

  await mongoose.connect(process.env.MONGODB_TEST_URI);
  console.log("Connection to MongoDB established for Jest")

  await User.deleteMany({})

  await User.create({
    username: TEST_USER_ADMIN.username,
    name: TEST_USER_ADMIN.name,
    email: TEST_USER_ADMIN.email,
    hashedPassword: hashedPassword,
    roles: TEST_USER_ADMIN.roles
  })

  const res = await request(app)
  .post("/api/login")
  .send({
    username: TEST_USER_ADMIN.username,
    password: TEST_USER_ADMIN.password
  });
  token = res.body.data.token
  console.log("token:", token)
})

afterAll(async () => {
  await User.deleteMany({})
  await mongoose.connection.close();
});

describe('GET /api/users', () => {
  it('should return 200 and a list of users when authorized and is admin', async () => {
    const res = await request(app)
      .get('/api/users')
      .set('Authorization', `Bearer ${token}`);  // Pass the token

    expect(res.status).toBe(200);
    expect(res.body.status).toBe(true);
    expect(Array.isArray(res.body.data)).toBe(true);
    expect(res.body.data.length).toBeGreaterThan(0);
  });

  it('should return 400 when no token', async () => {
    const res = await request(app)
      .get('/api/users')

    expect(res.status).toBe(401);
    expect(res.body.status).toBe(false);
  })

  it('should return 403 when a non-admin user tries to access the users list', async () => {
    // Simulate a non-admin user login
    const nonAdminToken = 'some-fake-token-for-non-admin';

    const res = await request(app)
      .get('/api/users')
      .set('Authorization', `Bearer ${nonAdminToken}`);

    expect(res.status).toBe(401);
    expect(res.body.status).toBe(false);
  });
})

describe('POST /api/users', () => {
  it('should return 201 and the created user when valid data is provided', async () => {
    const newUser = {
      username: 'newuser',
      name: 'New User',
      email: 'newuser@example.com',
      password: 'password123',
      roles: ['user']
    };

    const res = await request(app)
      .post('/api/users')
      .send(newUser);

    expect(res.status).toBe(201);
    expect(res.body.username).toBe(newUser.username);
    expect(res.body.name).toBe(newUser.name);
    expect(res.body.email).toBe(newUser.email);
    expect(res.body.roles).toEqual(newUser.roles);
  });

  it('should return 400 when required fields are missing', async () => {
    const newUser = {
      username: 'newuser',
      // Missing name, email, password, roles
    };

    const res = await request(app)
      .post('/api/users')
      .send(newUser);

    expect(res.status).toBe(500);
  });

  it('should return 400 when username already exists', async () => {
    const newUser = {
      username: 'existinguser',
      name: 'Existing User',
      email: 'existinguser@example.com',
      password: 'password123',
      roles: ['user']
    };

    // First, create a user with this username
    await request(app)
      .post('/api/users')
      .send(newUser);

    // Try to create the user again
    const res = await request(app)
      .post('/api/users')
      .send(newUser);

    expect(res.status).toBe(400);
  });
});
```

## Ï†Ï„Î¹Î±Ï‡Î½Ï‰ Î±ÎºÏŒÎ¼Î± Ï„ÎµÏƒÏ„ Î³Î¹Î± Ï„Î¿ message.tes.js
```javascript
const request = require('supertest');
const app = require('../app'); // Your Express app

describe('GET /api/message', () => {
  it('should return 200 and a welcome message', async () => {
    const res = await request(app).get('/api/message');

    expect(res.status).toBe(200);
    expect(res.body).toEqual({
      status: true,
      message: "Hello from the server!!"
    });
  });
});
```

## Î‘Î»Î»Î±Î³Î® ÏƒÏ„Î¿ package.json
### ÎµÏ€Î·Î´Î® Ï„Î± Ï„Î± Ï„ÎµÏƒÏ„ Ï„Î¿ ÎºÎ±Î¸Î­Î½Î± Î¼Î¿Î½Î¿ Ï„Î¿Ï… Ï€Î­ÏÎ½Î±Î³Îµ ÎºÎ±Î½Î¿Î½Î¹ÎºÎ¬ Î±Î»Î»Î¬ Î¿Î»Î± Î¼Î±Î¶Î¯ ÎºÎ¬Î½Î±Î½Îµ ÎºÎ¿Î½Ï†Î»Î¹ÎºÏ„ Ï€ÏÎ¿ÏƒÎ¸ÎµÏƒÎ± Ï„Î¿ **--runÎ™nBand** ÏƒÏ„Î¿ ÏƒÎºÏÎ¹Ï€Ï„ Ï‰ÏƒÏ„Îµ Î½Î± Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î­Î½Î± Î­Î½Î±
```javascript
    "test": "cross-env NODE_ENV=test jest --testTimeout=50000  --runInBand"
```

## Delete user
## user.dao.js (Î¸Î± Ï„Î¿ Ï‡ÏÎµÎ¹Î±ÏƒÏ„Ï ÏƒÎµ Î»Î¯Î³Î¿) Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰
```javascript
const deleteUserById = async (userId) => {
  return await User.findByIdAndDelete(userId)
}

module.exports = {
  findAllUsers,
  findUserByUsername,
  findUserByEmail,
  createUser,
  deleteUserById
};
```

## user.controller.js Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰
```javascript
exports.deleteById = async (req, res) => {
  const userId = req.params.id
  if (!userId){
    return res.status(400).json({
      status: false,
      error: 'User ID is required OR not found'
    })
  }
  try {
    const deleteUser = await userDAO.deleteUserById(userId) // to be added to user.dao.js
    if (!deleteUser){
      return res.status(404).json({
        status: false,
        error: 'Error deleting user: not found'
      })
    } else {
      res.status(200).json({
        status: true,
        message: `User ${deleteUser.username} deleted successfully`,
      })
    }
  } catch (error) {
    res.status(500).json({
      status: false,
      error: error.message
    })
  }
}
```
### Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î¿Ï… Î²Î¬Î»Ï‰ Î±Ï€Î¿ Ï€Î¬Î½Ï‰ ÎºÎ±Î¹ @swagger
```javascript
/**
 * @swagger
 * /api/users/{id}:
 *   delete:
 *     summary: Delete a user
 *     description: Admin only. Deletes a user by ID.
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *         description: User ID
 *     responses:
 *       200:
 *         description: User deleted
 *       400:
 *         description: Missing or invalid ID
 *       401:
 *         description: Unauthorized
 *       403:
 *         description: Forbidden
 *       404:
 *         description: User not found
 *       500:
 *         description: Server error
 */
```

## user.routes.js
```javascript
router.delete('/:id', verifyToken, checkRole('admin'), userController.deleteById)
```
### Î´Î¿ÎºÎ¹Î¼Î® Î¼Îµ postman ok
## Ï€ÏÎ¿ÏƒÎ¸Î®ÎºÎ· jest test ÏƒÏ„Î¿ users.test.js
```javascript
  it('creates a user and then deletes it', async () => {
    const newUser = {
      username: 'deleteme',
      name: 'deleteme',
      email: 'deleteme@example.com',
      password: '123',
      roles: ['user']
    };

    // First, create a user with this username
    const toBeDeletedUser = await request(app)
      .post('/api/users')
      .set('Authorization', `Bearer ${token}`)
      .send(newUser)
      .expect(201)

    // try to retrive user id
    const userId = toBeDeletedUser.body._id
    expect(userId).toBeDefined()

    await request(app)
      .delete(`/api/users/${userId}`)
      .set('Authorization', `Bearer ${token}`)
      .expect(200)
  });
  it('delete with no id expext 404', async () => {
    await request(app)
    .delete(`/api/users/`)
    .set('Authorization', `Bearer ${token}`)
    .expect(404)
  })
  it('delete with invalid id expect 404', async () => {
    const justAWrongId = '60c72b2f9b1e8b1a8b2a3c4d' //invalid id but valid mongo format
    await request(app)
    .delete(`/api/users/${justAWrongId}`)
    .set('Authorization', `Bearer ${token}`)
    .expect(404)
  })
  it('delete with invalid id expect 500', async () => {
    const justAWrongId = 'invalid id format' //invalid id and invalid mongo format
    await request(app)
    .delete(`/api/users/${justAWrongId}`)
    .set('Authorization', `Bearer ${token}`)
    .expect(500)
  })
```

# front end delete functionality
## App.jsx
```javascript
  const handleDeleteUser = async (userId) => {
    const token = localStorage.getItem("token");
    try {
      const response = await axios.delete(`${url}/users/${userId}`, {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });
      setTimeout(() => {
        setMessage("User is deleted");
      }, 7000);
      console.log("User deleted", response.data);
    } catch (error) {
      console.error("Failed to delete user", error.response?.data || error.message);
    }
  };
```
#### ÏƒÏ„Î¿ return (Ï€ÏÎ¿ÏƒÎ¸ÎµÏƒÎ± Ï„Î± handleDeleteUser)
```javascript
            <AdminPanel
              url={url}
              handleDeleteUser={handleDeleteUser}
            />
          </>
        } />  

        <Route path="/google-success" element={
          <GoogleSuccess setUser={setUser} setUserIsAdmin={setUserIsAdmin} />
        } />

        <Route path="/users" element={<AdminPanel handleDeleteUser={handleDeleteUser} url={url} />} />
        <Route path="/users/:id" element={<UserDetail />} />

```
## ÏƒÏ„Î¿ return Ï„Î¿Ï… AdminPanel.jsx (ÎµÎºÎµÎ¹ Ï€Î¿Ï… Î´Î·Î¼Î¹Î¿Ï…ÏÎ³ÎµÎ¯ Ï„Î·Î½ Î»Î¯ÏƒÏ„Î±)
```javascript
              <li key={user._id || `${user.username}-${user.email}`}>
                 <Link to={`/users/${user._id}`}>
                  {user.username}
                 </Link>
                 - {user.name} - {user.email} - {user.roles.join(", ")}
                 <button onClick={() => handleDeleteUser(user._id)}>Delete</button>
              </li>
```

# ÎœÎ¹ÎºÏÎ¿Ï€ÏÎ¿Î²Î»Î·Î¼Î± Î¼Îµ Î¼Î· Î¬Î¼ÎµÏƒÎ¿ responce ÏƒÏ„Î¿ render Î±Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Ï Î® ÏƒÎ²Î®Î½Ï‰ Ï‡ÏÎ®ÏƒÏ„Î·
## ÏƒÏ„Î¿ App.jsx ÏƒÏ„Î·Î½ handleDeleteUser Ï€ÏÎ¿ÏƒÎ¸ÎµÏƒÎ±
```javascript
    const isConfirmed = window.confirm("Are you sure you want to delete this user?")
    if (!isConfirmed) {
      console.log("User deletion cancelled");
      return; // Exit the function if the user cancels
    }
// [...]
      alert('User deleted successfully!')
      // âœ… Î±Ï€Î»ÏŒ "Ï†ÏÎµÏƒÎºÎ¬ÏÎ¹ÏƒÎ¼Î±" Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î³Î¹Î± Î½Î± Î¾Î±Î½Î±Ï„ÏÎ±Î²Î®Î¾ÎµÎ¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
      window.location.reload()
```

## ÎºÎ±Î¹ Ï„Î¿ Î¹Î´Î¹Î¿ ÎºÎ±Î¹ ÏƒÏ„Î¿ NewUserForm.jsx ÏƒÏ„Î·Î½ handleSubmitUser
```javascript
      // âœ… Î±Ï€Î»ÏŒ "Ï†ÏÎµÏƒÎºÎ¬ÏÎ¹ÏƒÎ¼Î±" Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î³Î¹Î± Î½Î± Î¾Î±Î½Î±Ï„ÏÎ±Î²Î®Î¾ÎµÎ¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
      window.location.reload()
```

# cypress tests
## /cypress
### npm init
### npm install --save-dev cypress
### ÏƒÏ„Î¿ Package Ï„Î¿Ï… Î½ÎµÎ¿Ï†Ï„Î¹Î±Î³Î¼Î­Î½Î¿Ï… Î±Ï€Ï€
```javascript
  "scripts": {
    "cypress:open": "cypress open"
```
### ÏƒÏ„Î¿ package Ï„Î¿Ï… backend
```javascript
    "start:test": "NODE_ENV=test node index.js"
```
### ÏƒÏ„Î¿ package Ï„Î¿Ï… frontend
#### Î±Ï…Ï„Î® ÎµÎ¯Î½Î±Î¹ Î· ÎµÎ¾Î®Î³Î·ÏƒÎ· Ï„Î¿Ï… gpt: *Vite (by default) may bind to 127.0.0.1 or IPv6 ::1 only. Cypress might try to use localhost, which sometimes resolves differently (especially on Linux or WSL). Fix: Tell Vite to use 0.0.0.0 (bind to all interfaces):*
```javascript
"scripts": {
  "dev": "vite --host"
}
```
### When both the backend and frontend are running, we can start Cypress with the command Î±Ï€Î¿ Ï„Î¿ Ï†Î¬ÎºÎµÎ»Î¿ Ï„Î¿Ï… cypress 
- **npm run cypress:open** 
- create new spec 
- cypress\e2e\loginApp.cy.js

## notes\loginApp\cypress\cypress\e2e\loginApp.cy.js
#### Î±ÏÏ‡Î¹ÎºÎ¬ Î¼Îµ Î±Ï…Ï„ÏŒ Î²Î»Î­Ï€Ï‰ Î¿Ï„Î¹ Ï„Î¿ cypress Î›ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ 
```javascript
describe ('Login App', () =>{
const urlF = 'http://localhost:5173'
  it('page can be accesed', function() {
    cy.visit(urlF)
  })
})
```

## loginApp.cy.js
```javascript
describe ('Login App', () =>{

const urlB = 'http://localhost:3000'
const urlF = 'http://localhost:5173'
```
### Î³Î¹Î± Ï„Î± Ï„ÎµÏƒÏ„ Î¼Î¿Ï… Î¸Î± Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÏ‰ Î´ÏÎ¿ Ï‡ÏÎ·ÏƒÏ„ÎµÏ‚ Î­Î½Î±Î½ Î±Î½Ï„Î¼Î¹Î½ ÎºÎ±Î¹ Î­Î½Î±Î½ Î¿Ï‡Î¹. Î£Ï„Î·Î½ Î±ÏÏ‡Î® Î¸Î± Ï€Î¬ÏÏ‰ Ï„Î± Ï„Î¿ÎºÎµÎ½ ÎºÎ±Î¹ Ï„Î± id, Î³Î¹Î± Î½Î± Ï„Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÏ‰ Î³Î¹Î± Î½Î± Ï„Î¿Ï…Ï‚ ÏƒÎ²Î®ÏƒÏ‰ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚ Ï„Î¿Ï… Ï„ÎµÏƒÏ„
```javascript
const user = {
  name: 'testerAdmin',
  username: 'testerAdmin',
  password: '123',
  email: 'admin@google.com',  // Ï€ÏÎ¿ÏƒÎ¿Ï‡Î· Ï„Î¿ Î¼ÎµÎ·Î» Î·Ï„Î±Î½ Ï…Ï€Î¿Ï‡ÏÎµÏ‰Ï„Î¹ÎºÎ¿
  roles: ['admin']
}

const user2 = {
  name: 'tester',
  username: 'tester',
  password: '123',
  email: 'user2@google.com',
  roles: ['user']
}

let userIdAdmin = null
let tokenAdmin = null

let userId2 = null
let token2 = null

  before(() => {
    // Î³Î¹Î± Ï„Î·Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… admin
    cy.request('POST', `${urlB}/api/users`, user)
      .then((res) => {
        userIdAdmin = res.body._id
        expect(userIdAdmin).to.exist
        console.log('userId:', userIdAdmin);
      })
    cy.request('POST', `${urlB}/api/login`, {
      username:user.username,
      password:user.password
    })
      .then((res) => {
        tokenAdmin = res.body.data.token
        expect(tokenAdmin).to.exist
        console.log('token:', tokenAdmin)        
      })
    
    cy.wait(500)

    // Î³Î¹Î± Ï„Î·Î½ Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï„Î¿Ï… user2
    cy.request('POST', `${urlB}/api/users`, user2)
      .then((res) => {
        userId2 = res.body._id
        expect(userId2).to.exist
        console.log('user2Id:', userId2);
      })
    cy.request('POST', `${urlB}/api/login`, {
      username:user2.username,
      password:user2.password
    })
      .then((res) => {
        token2 = res.body.data.token
        expect(token2).to.exist
        console.log('token2:', token2)        
      })
  })

  after(() => {
    console.log('TokenAdmin for delete request:', tokenAdmin)
    cy.request({
      method: 'DELETE',
      url: `${urlB}/api/users/${userIdAdmin}`,
      headers: {
        Authorization: `Bearer ${tokenAdmin}`
      }
    }).then((res) => {
      expect(res.status).to.eq(200)
    })

    cy.wait(500)

    cy.request({
      method: 'DELETE',
      url: `${urlB}/api/users/${userId2}`,
      headers: {
        Authorization: `Bearer ${tokenAdmin}`
      }
    }).then((res) => {
      expect(res.status).to.eq(200)
    })
```

## Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰ id ÏƒÏ„Î± Î´Î¹Î±Ï†Î¿ÏÎ± element Ï„Î¿Ï… LoginForm.jsx
```javascript
//App.jsx
          id='home'
//LoginForm.jsx
          id="username"
          id="password"
          id="loginBtn"
//UserLogedinView
          id="logoutBtn"
          id="adminBtn"
// AdminPanel.jsx
          id={`${user.username}Btn`}  //Ï€ÏÎ¿ÏƒÎ¿Ï‡Î®
          id="createUserBtn"
// NewUserForm.jsx
          id='createUsername'
          id='createName'
          id='createEmail'
          id='createPassword'
          id='submitCreateBtn'

```
### Î´Î¹Î±Ï†Î¿ÏÎ± Ï„ÎµÏƒÏ„
```javascript
  it('page can be accesed', function() {
    cy.visit(urlF)
    cy.contains('Login APP')
    cy.contains('login')
    cy.contains('username').should('exist')
    cy.contains('password').should('exist')
    cy.get('form').should('exist')
  })

  it('succeeds with correct credentials', function () {
    cy.visit(urlF) 
    cy.get('#username').type('tester')
    cy.get('#password').type('123')
    cy.get('#loginBtn').click()
    cy.contains('Welcome user')
    cy.get('#adminBtn').should('not.exist')
    cy.get('#logoutBtn').click()
  })

  it('succeeds with admin credentials and can do admin oparations', function () {
    cy.visit(urlF) 
    cy.get('#username').type('testerAdmin')
    cy.get('#password').type('123')
    cy.get('#loginBtn').click()
    cy.contains('Welcome user')
    cy.get('#adminBtn').should('exist')
    cy.get('#adminBtn').click()
    cy.get('#createUserBtn').click()
    cy.get('#createUsername').type('DeleteMe')
    cy.get('#createName').type('DeleteMe')
    cy.get('#createEmail').type('DeleteMe@junkmail.com')
    cy.get('#createPassword').type('123')
    cy.wait(500)
    cy.get('#submitCreateBtn').click()
    cy.wait(5000)
    cy.get('#adminBtn').click()
    cy.wait(5000)
    cy.get('#DeleteMeBtn').should('exist')
    cy.get('#DeleteMeBtn').click()
    cy.wait(5000)
    cy.get('#adminBtn').click()
    cy.wait(5000)
    cy.contains('DeleteMe').should('not.exist')
    // cy.wait(5000)
    // cy.get('#logoutBtn').click()
  })
```

## Ï„Î± Ï„ÎµÏƒÏ„ Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î¼Îµ
```
npm run cypress:open
```

# **Deploy**

### ÏƒÏ„Î¿ .gitignore Î±Î½Ï„Î¹ÎºÎ±Î¸Î·ÏƒÏ„Ï‰ Ï„Î¿ dist Î¼Îµ 
```
# Ignore the dist inside frontend
notes/loginApp/frontend/dist/

# But don't ignore the dist inside loginApp (force include)
!notes/loginApp/dist/
```

### https://dashboard.render.com
- +create new service
- web services
- -> git provider -> https://github.com/alkisax/loginAPP -> credentials -> alkisax -> configure in github -> authenticate -> loginAPP
- Free
- Î ÏÎ¿ÏƒÎ¸Î·ÎºÎ· .env variables
-- MONGODB_URI
-- SECRET
-- JWT_SECRET
-- GOOGLE_CLIENT_ID
-- GOOGLE_CLIENT_SECRET
-- REDIRECT_URI
-- APP_URL
- Deploy web service
- setings
-- (start command 'npm start')

# Î±Î»Î»Î±Î³Î® Ï„Ï‰Î½ Url
## App.js
```
const url = 'https://loginapp-tjlf.onrender.com/api'
```

# ***ERROR*** runs only when local back open
# ***IMPORTANT*** *Î±Ï€Î¿ ÎµÎ´Ï ÎºÎ±Î¹ Ï€Î­ÏÎ± Î¿Î»ÎµÏ‚ Î¿Î¹ Î±Î»Î»Î±Î³ÎµÏ‚ ÏƒÏ„Î¿ front Î±Ï€Î±Î¹Ï„Î¿Ï…Î½ nmp run build, Î±Î»Î»Î±Î³Î® Ï„Ï‰Î½ Ï†Î±ÎºÎ­Î»Ï‰Î½ dist ÎºÎ±Î¹ Î½Î­Î¿ git push*

#### Î‘Ï€Î¿ Ï„Î¿ chatGPT: When you call: window.location.reload() It forces a full-page reload, and React Router tries to resolve the route (e.g., /admin) by making a direct GET request to the server (https://loginapp-tjlf.onrender.com/admin). But your backend doesnâ€™t have a route for /admin, because it's a frontend-only route managed by React Router â€” hence the 404 error
## App.jsx
```javascript
  const [users, setUsers] = useState([])
//[...]
  const handleDeleteUser = async (userId) => {
    const isConfirmed = window.confirm("Are you sure you want to delete this user?")
    if (!isConfirmed) {
      console.log("User deletion cancelled");
      return; // Exit the function if the user cancels
    }
    const token = localStorage.getItem("token");
    try {
      const response = await axios.delete(`${url}/users/${userId}`, {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });

      setTimeout(() => {
        setMessage("User is deleted");
      }, 7000);
      console.log("User deleted", response.data);
      alert('User deleted successfully!')

      // âœ… Î±Ï€Î»ÏŒ "Ï†ÏÎµÏƒÎºÎ¬ÏÎ¹ÏƒÎ¼Î±" Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î³Î¹Î± Î½Î± Î¾Î±Î½Î±Ï„ÏÎ±Î²Î®Î¾ÎµÎ¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
      // window.location.reload()
      setUsers(users.filter(user => user.id !== userId)); // Î±Ï…Ï„Î¿ Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸Î·ÎºÎµ Î³Î¹Î±Ï„Î¹ Î´ÎµÎ½ Ï€ÏÎµÏ€ÎµÎ¹ Î½Î± ÎºÎ±Î½ÎµÎ¹Ï‚ Î±Î½Î±Î½ÎµÏ‰ÏƒÎ· Ï„Î·Ï‚ ÏƒÎµÎ»Î¹Î´Î±Ï‚ ÏƒÎµ single page app

    } catch (error) {
      console.error("Failed to delete user", error.response?.data || error.message);
    }
  };
// [...]
            <AdminPanel
              url={url}
              handleDeleteUser={handleDeleteUser}
              users={users}
              setUsers={setUsers}
            />
```
## AdminPanel.jsx
```javascript
const AdminPanel = ({url, handleDeleteUser, users, setUsers}) => {
// [...]
      <button id="createUserBtn" onClick={() => setViewForm(!viewForm)}>create user form</button>
      {viewForm && <NewUserForm users={users} setUsers={setUsers} url={url} />}
```
## NewUserForm.jsx
```javascript
const NewUserForm = ({ url, users, setUsers }) =>{
// [...]
  const handleSubmitUser = async (event) => {
    event.preventDefault()
    
    try {
      const newUser = {
        "username": username,
        "name": name,
        "email": email,
        "password": password,
        "roles": roles
      }

      const response = await axios.post(`${url}/users`, newUser)

      console.log('âœ… User created:', response.data)
      alert('User created successfully!')

      // Clear the form if needed
      setUsername('')
      setName('')
      setEmail('')
      setPassword('')
      setRoles(['user'])

      // Redirect to /admin after creating the user
      // navigate('/admin');
      // âœ… Î±Ï€Î»ÏŒ "Ï†ÏÎµÏƒÎºÎ¬ÏÎ¹ÏƒÎ¼Î±" Ï„Î·Ï‚ ÏƒÎµÎ»Î¯Î´Î±Ï‚ Î³Î¹Î± Î½Î± Î¾Î±Î½Î±Ï„ÏÎ±Î²Î®Î¾ÎµÎ¹ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
      // window.location.reload()
      // Update users list directly
      setUsers([...users, response.data]); // Î±Ï…Ï„Î¿ Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸Î·ÎºÎµ Î³Î¹Î±Ï„Î¹ Î´ÎµÎ½ Ï€ÏÎµÏ€ÎµÎ¹ Î½Î± ÎºÎ±Î½ÎµÎ¹Ï‚ Î±Î½Î±Î½ÎµÏ‰ÏƒÎ· Ï„Î·Ï‚ ÏƒÎµÎ»Î¹Î´Î±Ï‚ ÏƒÎµ single page app

    } catch (error) {
      console.error('Error creating user:', error)
    }
  }

```
# **ERROR** google login URI points local
## App.jsx
```javascript
            <LoginForm 
              username={username}
              password={password}
              setUsername={setUsername}
              setPassword={setPassword}
              handleLogin={handleLogin}
              url={url} // Ï€ÎµÏÎ½Î¬Ï‰ Ï„Î¿ url
            />}
```
## LoginForm.jsx
```javascript
  // const googleUrl = 'https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=http://localhost:3000/api/login/google/callback&response_type=code&scope=email%20profile&access_type=offline'
  const googleUrl = `https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=${url}/login/google/callback&response_type=code&scope=email%20profile&access_type=offline`;
```

## ÏƒÏ„Î¿ https://console.cloud.google.com/auth/clients/
- Authorized redirect URIs
-- http://localhost:3000/api/login/google/callback
-- http://localhost:5173/
-- https://loginapp-tjlf.onrender.com/api/login/google/callback

## ÏƒÏ„Î¿ render -> enviroment
REDIRECT_URI=https://loginapp-tjlf.onrender.com/api/login/google/callback

## Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ‰ Ï„Î¿ Î½Î­Î¿ google log in ÏƒÏ„Î¿ auth.routes.js
// https://accounts.google.com/o/oauth2/auth?client_id=37391548646-a2tj5o8cnvula4l29p8lodkmvu44sirh.apps.googleusercontent.com&redirect_uri=https://loginapp-tjlf.onrender.com/api/login/google/callback&response_type=code&scope=email%20profile&access_type=offline

# fix Cannot GET /google-success
# fix /admin refresh
# ***Î˜Î•Î›Î•Î™ Î•ÎÎ—Î“Î—Î£Î— Î“Î™Î‘Î¤Î™ Î‘Î Î›ÎŸÎ£ Î¤ÎŸ Î Î•Î™Î¡Î‘ Î‘Î ÎŸ Î¤ÎŸ GPT**
## ÏƒÏ„Î¿ app.js ÏƒÏ„Î¿ back Ï€ÏÎ¿ÏƒÎ¸Î­Ï„Ï‰
```javascript
const path = require('path'); // requires explanation. added for rendering front page subpages
// [...]
app.get('*', (req, res) => {
  if (req.path.startsWith('/api')) return res.status(404).json({
     error: 'API route not found'
    }); // requires explanation. added for rendering front page subpages

  res.sendFile(path.join(__dirname, 'dist', 'index.html'));
});
```
# delete does not rerender
## ÏƒÏ„Î¿ App.jsx Î±Î»Î»Î±Î¾Îµ Î±Ï€Î»ÏÏ‚ Ï„Î¿ user.id ÏƒÎµ user._id
```
      setUsers(users.filter(user => user._id !== userId));
```

## ***TODO remove hardcoded Url from auth.controller.js and create FRONTEND_URL env variable ***
### ÏƒÏ„Î¿ .env ÎºÎ±Î¹ ÏƒÏ„Î± enviroment Ï„Î¿Ï… Render
```
FRONTEND_URL=https://loginapp-tjlf.onrender.com
```
## ÏƒÏ„Î¿ auth.controller.js
  const frontendUrl = process.env.FRONTEND_URL
  return res.redirect(`${frontendUrl}/google-success?token=${token}&email=${dbUser.email}`);


# change in loginApp.cy.js
```
// const urlB = 'http://localhost:3000'
// const urlF = 'http://localhost:5173'
const urlB = 'https://loginapp-tjlf.onrender.com'
const urlF = 'https://loginapp-tjlf.onrender.com'
```
### Î±Ï†Î±Î¹ÏÎ­Î¸Î·ÎºÎ±Î½ Î¼ÎµÏÎ¹ÎºÎ­Ï‚ Î³ÏÎ±Î¼Î¼ÎµÏ‚ Î³Î¹Î±Ï„Î¹ Î®Ï„Î±Î½ Ï€Î¹Î± Ï€ÎµÏÎ¹Ï„Î­Ï‚ Î»Î¿Î³Î¿ Ï„Î¿Ï… rerender
```
    // cy.wait(5000)
    // cy.get('#adminBtn').click()
```
## Ï„Î± Ï„ÎµÏƒÏ„ Ï„ÏÎ­Ï‡Î¿Ï…Î½ Î±Ï€Î¿ Ï„Î¿ Ï†Î±ÎºÎµÎ»Î¿ Ï„Î¿Ï… cypress Î¼Îµ npm run cypress:open



